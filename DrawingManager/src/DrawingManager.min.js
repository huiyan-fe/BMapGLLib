var BMapGLLib=window.BMapGLLib=BMapGLLib||{};var BMAP_DRAWING_MARKER="marker",BMAP_DRAWING_POLYLINE="polyline",BMAP_DRAWING_CIRCLE="circle",BMAP_DRAWING_RECTANGLE="rectangle",BMAP_DRAWING_POLYGON="polygon";(function(){var d="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAAXNSR0IArs4c6QAAAs1JREFUWAnNmb9v01AQx989SzVI8dIBJNZ27Mb/QRpExMiOKAW1Mw3MRVCB2BlRECF/CBtjuwbBwGJL1JXs474vtuU4Tkho4tyTGr9ffvfxvV93VzL/mfYPLndSumqT4buG6Y4MI3+MpyQayc/IEI/Y0DfLW8Ov725cuKYlf2iZ/p3j8FZylT4hQx1m3lvmXSL6zoYH3pZ9PzgNfi367kKA3R634t/REXF6zMa0Fh28rp8IjJjsqb/det3vUVTXp1z3T8DOs/B+kvIHw3y7/OK180Q/PUuPB2+DL/PGsrMaZQrp3tPwJEn488rhIFQ+GGNDBmTN4qht6D7nm3ESfpRBurNeXGk9Ud/3gkf9N/SnOu6UBvE1jcKBSBQBmXWanAJsH0YvGtNcWV0C6WSX6yQ/McVuQ2DNycFW6ddQkdjz6EF54xQg46MkPMfibYimXozsbn872M2PoGKKcc5tHA7IoiDHkuE7DeKGSOP04rqHcL1Klq8VqMj6dgc3jtMgx+mBFjh8DlhwpSI/BiTaR0FTwn0PHnJWiYnPNcHlLNb4uxYmU16h7Qk26+w5bWQZD9hsZmzqRBRDGJsks4JVMgIwN9M1ArIAykRrRHNMwoY1+EMtoLBhDcID05pGMsWsF1DYLPxWrepzPjWcaq2AYLPw+OFUa4MEE9jG1ox4/NoAEYUAkwNEOAJGohZIsICpAITlinCEFkCw5PEbp0GAIVZixGHZOKRzmoQlSwUgvCjESsSG3eDVJ26nMOQeHRgLQBScP0r0EvmNJJFd9onBIOtxMiH80D4MPzUeXZD4zPAseCjHy8QMTmgQqOiAQI5k+pPoayxlwaMqnOOZJXasSRenOVlfKES0JdM6PGu9qoObC5iDqw1g5oBYtIiVGLK9VRzmbgwZC2NWN0Qus/yc2iTlxmoeIRIXhRBHX5bAXrV9XlmmcH1B9DrBTf0b4i99lUEMOuku/wAAAABJRU5ErkJggg==";var n="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAd9JREFUOBGtVc8rRFEUPufOvELMguTHwkbKjxRlo9gqNpjyFyhTit3I8i1ldpQa5S9QmA1lS9koSn6UZmMxSCyGkPlx3O+9mTe8Zl4zw7eZ7rnn++aee893HlMRzEXFeLh6m2LJTpHwEJG022mcIJZTYbXX2lu/txnilJvO7sDkYnJaC0REqNO993PNTHEiDsfWAru/4vmFaYo6e35dEZIwYh1tPhobNmig20/NjcpKe3rJ0vlNmg5PUnR3n7FiTBwZbGpYNk3OIuCccHIhuQoxv49lNljD4yMG6VMUhT49HRynaGvnU9IZ0Wkcia0HlhxBlCkiOxAz5+u4v8tXVMgdvLjNkLnxbosyB1E+4wEeL5PXuLPQTC1NjBpunud6/yhF0e0PVBNv6Qv0KLwmxHBnKLNSgAMuNKClrNbQKniAUnfm9SfggAtAS9l9RtZrehG99tAJFnTP6n6wmzbfGl7EUnsFrrTbDVYqs4q4FtR20kDTVosClxMK3oQQHFAtHK7WUjA6hGAnOKBSgAMuAC2FqYGmhDdhp0oBDrjQgJayRxBbAwHehJ3KBXLBsfM5DC3H/v81HHIdSYQRpMcX6ekRhjcPjr/KGV+6Unt8xXJlOSfMl/lvAzYviN+/fAK+AW5jAVefzjWGAAAAAElFTkSuQmCC";var k="data:image/png;base64,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";var e=e||{guid:"$BAIDU$"};(function(){window[e.guid]={};e.extend=function(r,o){for(var q in o){if(o.hasOwnProperty(q)){r[q]=o[q]}}return r};e.lang=e.lang||{};e.lang.guid=function(){return"TANGRAM__"+(window[e.guid]._counter++).toString(36)};window[e.guid]._counter=window[e.guid]._counter||1;window[e.guid]._instances=window[e.guid]._instances||{};e.lang.Class=function(o){this.guid=o||e.lang.guid();window[e.guid]._instances[this.guid]=this};window[e.guid]._instances=window[e.guid]._instances||{};e.lang.isString=function(o){return"[object String]"==Object.prototype.toString.call(o)};e.lang.isFunction=function(o){return"[object Function]"==Object.prototype.toString.call(o)};e.lang.Class.prototype.toString=function(){return"[object "+(this._className||"Object")+"]"};e.lang.Class.prototype.dispose=function(){delete window[e.guid]._instances[this.guid];
for(var o in this){if(!e.lang.isFunction(this[o])){delete this[o]}}this.disposed=true};e.lang.Event=function(o,p){this.type=o;this.returnValue=true;this.target=p||null;this.currentTarget=null};e.lang.Class.prototype.addEventListener=function(r,q,p){if(!e.lang.isFunction(q)){return}!this.__listeners&&(this.__listeners={});var o=this.__listeners,s;if(typeof p=="string"&&p){if(/[^\w\-]/.test(p)){throw ("nonstandard key:"+p)}else{q.hashCode=p;s=p}}r.indexOf("on")!=0&&(r="on"+r);typeof o[r]!="object"&&(o[r]={});s=s||e.lang.guid();q.hashCode=s;o[r][s]=q};e.lang.Class.prototype.removeEventListener=function(q,p){if(e.lang.isFunction(p)){p=p.hashCode}else{if(!e.lang.isString(p)){return}}!this.__listeners&&(this.__listeners={});q.indexOf("on")!=0&&(q="on"+q);var o=this.__listeners;if(!o[q]){return}o[q][p]&&delete o[q][p]};e.lang.Class.prototype.dispatchEvent=function(s,o){if(e.lang.isString(s)){s=new e.lang.Event(s)}!this.__listeners&&(this.__listeners={});o=o||{};for(var r in o){s[r]=o[r]}var r,q=this.__listeners,u=s.type;s.target=s.target||this;s.currentTarget=this;u.indexOf("on")!=0&&(u="on"+u);e.lang.isFunction(this[u])&&this[u].apply(this,arguments);if(typeof q[u]=="object"){for(r in q[u]){q[u][r].apply(this,arguments)}}return s.returnValue};e.lang.inherits=function(u,s,r){var q,t,o=u.prototype,p=new Function();p.prototype=s.prototype;t=u.prototype=new p();for(q in o){t[q]=o[q]}u.prototype.constructor=u;u.superClass=s.prototype;if("string"==typeof r){t._className=r}};e.dom=e.dom||{};e._g=e.dom._g=function(o){if(e.lang.isString(o)){return document.getElementById(o)}return o};e.g=e.dom.g=function(o){if("string"==typeof o||o instanceof String){return document.getElementById(o)}else{if(o&&o.nodeName&&(o.nodeType==1||o.nodeType==9)){return o}}return null};e.insertHTML=e.dom.insertHTML=function(r,o,q){r=e.dom.g(r);var p,s;if(r.insertAdjacentHTML){r.insertAdjacentHTML(o,q)}else{p=r.ownerDocument.createRange();o=o.toUpperCase();if(o=="AFTERBEGIN"||o=="BEFOREEND"){p.selectNodeContents(r);p.collapse(o=="AFTERBEGIN")}else{s=o=="BEFOREBEGIN";p[s?"setStartBefore":"setEndAfter"](r);p.collapse(s)}p.insertNode(p.createContextualFragment(q))}return r};e.ac=e.dom.addClass=function(t,u){t=e.dom.g(t);var p=u.split(/\s+/),o=t.className,s=" "+o+" ",r=0,q=p.length;for(;r<q;r++){if(s.indexOf(" "+p[r]+" ")<0){o+=(o?" ":"")+p[r]}}t.className=o;return t};e.event=e.event||{};e.event._listeners=e.event._listeners||[];e.on=e.event.on=function(p,s,u){s=s.replace(/^on/i,"");p=e._g(p);var t=function(w){u.call(p,w)},o=e.event._listeners,r=e.event._eventFilter,v,q=s;s=s.toLowerCase();if(r&&r[s]){v=r[s](p,s,t);q=v.type;t=v.listener}if(p.addEventListener){p.addEventListener(q,t,false)}else{if(p.attachEvent){p.attachEvent("on"+q,t)}}o[o.length]=[p,s,u,t,q];return p};e.un=e.event.un=function(q,t,p){q=e._g(q);t=t.replace(/^on/i,"").toLowerCase();var w=e.event._listeners,r=w.length,s=!p,v,u,o;while(r--){v=w[r];if(v[1]===t&&v[0]===q&&(s||v[2]===p)){u=v[4];o=v[3];if(q.removeEventListener){q.removeEventListener(u,o,false)}else{if(q.detachEvent){q.detachEvent("on"+u,o)}}w.splice(r,1)}}return q};e.getEvent=e.event.getEvent=function(o){return window.event||o};e.getTarget=e.event.getTarget=function(o){var o=e.getEvent(o);return o.target||o.srcElement};e.preventDefault=e.event.preventDefault=function(o){var o=e.getEvent(o);if(o.preventDefault){o.preventDefault()}else{o.returnValue=false}};e.stopBubble=e.event.stopBubble=function(o){o=e.getEvent(o);o.stopPropagation?o.stopPropagation():o.cancelBubble=true};e.browser=e.browser||{};if(/msie (\d+\.\d)/i.test(navigator.userAgent)){e.browser.ie=e.ie=document.documentMode||+RegExp["\x241"]}})();var j=BMapGLLib.DrawingManager=function(p,o){if(!p){return}a.push(this);o=o||{};this.overlays=[];this._initialize(p,o)};e.lang.inherits(j,e.lang.Class,"DrawingManager");j.prototype.open=function(){if(this._isOpen==true){return true}f(this);this._open()};j.prototype.close=function(){if(this._isOpen==false){return true}var o=this;this._close();o._map.removeOverlay(b);setTimeout(function(){o._map.enableDoubleClickZoom()},2000)};j.prototype.setDrawingMode=function(o){if(this._drawingType!=o){f(this);this._setDrawingMode(o)}};j.prototype.getDrawingMode=function(){return this._drawingType};j.prototype.enableCalculate=function(){this._enableCalculate=true;this._addGeoUtilsLibrary()};j.prototype.disableCalculate=function(){this._enableCalculate=false};j.prototype.enableSorption=function(){this._enableSorption=true};j.prototype.disableSorption=function(){this._enableSorption=false};j.prototype.enableGpc=function(){this._enableGpc=true;this._addGPCLibrary()};j.prototype.disableGpc=function(){this._enableGpc=false};j.prototype.getOverlays=function(){return this.overlays};j.prototype.addOverlayData=function(o){return this.overlays.push(o)};j.prototype.setOverlaysData=function(o){return this.overlays=o};j.prototype.clearOverlayData=function(o){var q=this._map;for(var p=0;p<this.overlays.length;p++){if(this.overlays[p]===o){this.overlays.splice(p,1);
return o}}};j.prototype.clearOverlay=function(o){var p=this._map;var o=this.clearOverlayData(o);if(o){p.removeOverlay(o)}};j.prototype.clearOverlays=function(){var o=this._map;this.overlays.forEach(function(p){o.removeOverlay(p)});this.overlays.length=0};j.prototype.setOverlayEdit=function(p,o){if(["circle","rectangle","polygon","polyline"].includes(p)){this.clearOverlay(o);this._map.removeOverlay(o);this._drawingType=p;this._open(true,o)}else{console.error("暂不支持的编辑类型",p)}};j.prototype._initialize=function(q,p){this._map=q;this._opts=p;this._drawingType=p.drawingMode||BMAP_DRAWING_MARKER;if(p.enableDrawingTool){this.enableDrawingTool()}if(p.sorptionDistance!==undefined){this.setSorptionDistance(p.sorptionDistance)}if(p.enableCalculate===true){this.enableCalculate()}else{this.disableCalculate()}if(p.enableLimit===true){var o=p.limitOptions;this.limit=o}if(p.enableSorption===true){this.enableSorption()}else{this.disableSorption()}if(p.enableGpc===true){this.enableGpc()}else{this.disableGpc()}this._isOpen=!!(p.isOpen===true);if(this._isOpen){this._open()}this.setPolygonOptions(p.polygonOptions);this.setMarkerOptions(p.markerOptions);this.setCircleOptions(p.circleOptions);this.setPolylineOptions(p.polylineOptions);this.setRectangleOptions(p.rectangleOptions);this.setLabelOptions(p.labelOptions);this.controlButton=p.controlButton=="right"?"right":"left";this.skipEditing=p.skipEditing===undefined?false:p.skipEditing};j.prototype.enableDrawingTool=function(){var o=this._opts;if(!this._drawingTool){var p=new g(this,o.drawingToolOptions);this._drawingTool=p}this._map.addControl(this._drawingTool)};j.prototype.disableDrawingTool=function(){if(this._drawingTool){this._map.removeControl(this._drawingTool)}};j.prototype.setSorptionDistance=function(o){this._sorptionDistance=o||0};j.prototype.setPolygonOptions=function(o){this.polygonOptions=o||{}};j.prototype.setMarkerOptions=function(o){this.markerOptions=o||{}};j.prototype.setCircleOptions=function(o){this.circleOptions=o||{}};j.prototype.setPolylineOptions=function(o){this.polylineOptions=o||{}};j.prototype.setRectangleOptions=function(o){this.rectangleOptions=o||{}};j.prototype.setLabelOptions=function(o){this.labelOptions=o||{}};j.prototype._open=function(p,o){this._isOpen=true;if(!this._mask){this._mask=new h()}this._map.addOverlay(this._mask);this._setDrawingMode(this._drawingType,p,o)};j.prototype._setDrawingMode=function(o,q,p){this._drawingType=o;if(this._isOpen){this._mask.__listeners={};switch(o){case BMAP_DRAWING_MARKER:this._bindMarker();break;case BMAP_DRAWING_CIRCLE:this._bindCircle(q,p);break;case BMAP_DRAWING_POLYLINE:case BMAP_DRAWING_POLYGON:this._bindPolylineOrPolygon(q,p);break;case BMAP_DRAWING_RECTANGLE:this._bindRectangle(q,p);break}}if(this._drawingTool&&this._isOpen){this._drawingTool.setStyleByDrawingMode(o)}};j.prototype._close=function(){this._isOpen=false;if(this._mask){this._map.removeOverlay(this._mask)}if(this._drawingTool){this._drawingTool.setStyleByDrawingMode("hander")}};j.prototype._skipEditing=function(){var p=this[this._drawingType+"Options"];var o=this.skipEditing;var q=null;if(p){q=undefined===p.skipEditing?q:p.skipEditing}if((q||o)&&q!==false){document.getElementById("confirmOperate").click()}};j.prototype._bindMarker=function(){var q=this,r=this._map,p=this._mask;var o=function(t){var s=new BMapGL.Marker(t.point,q.markerOptions);r.addOverlay(s);q.addOverlayData(s);q._dispatchOverlayComplete(s)};p.addEventListener("click",o)};var b=null;j.prototype._bindCircle=function(D,x){var L=this,K=this._map,H=this._mask,t=null,N=[],E=null;var s=1;var q=null;var A=null;var o=null;var w=null;var B={strokeColor:"#4E6DF1",strokeWeight:2};var u=new BMapGL.Icon(d,new BMapGL.Size(20,20));var F=new BMapGL.Icon(k,new BMapGL.Size(40,20),{imageOffset:new BMapGL.Size(0,10)});var I=function(P){if(L.controlButton=="right"&&(P.button==1||P.button==0)){return}E=P.point;var O=new BMapGL.Marker(E);u.setImageSize(new BMapGL.Size(20,20));O.setIcon(u);O.enableDragging();O.addEventListener("dragstart",C);O.addEventListener("dragging",y);O.addEventListener("dragend",M);K.addOverlay(O);N.push(O);t=new BMapGL.Circle(E,s,L.circleOptions);K.addOverlay(t);H.enableEdgeMove();H.addEventListener("mousemove",z);e.on(document,"mouseup",G)};var z=function(O){s=L._map.getDistance(E,O.point).toFixed(0);t.setRadius(s);K.removeOverlay(b);b=new BMapGL.Label("半径："+s+"米<br>松开完成绘制",{position:O.point,offset:new BMapGL.Size(10,10)});b.setStyle(L.labelOptions);K.addOverlay(b)};var G=function(R){var S=K.getViewport(t.getBounds());S.zoom-=1;K.setViewport(S);K.removeOverlay(b);var Q=new BMapGL.Point(t.getBounds().getNorthEast().lng,E.lat);H.hide();q=new BMapGL.Marker(Q);q.setIcon(F);q.enableDragging();A=new BMapGL.Polyline([E,Q],B);var T=new BMapGL.Point((t.getBounds().getNorthEast().lng+E.lng)/2,E.lat);o=new l("circle",T,s,t,L);N=N.concat([q,A,o]);var O=null;if(L.limit){O=L.limit.area}var P={limit:O,type:"circle",point:Q,overlay:t,overlays:N};w=new c(P,L);K.addOverlay(q);K.addOverlay(A);
K.addOverlay(o);K.addOverlay(w);L._skipEditing();o.addEventListener("radiuschange",function(Z){var U=Z.radius;t.setRadius(U);var Y=i(E,U,"east");var V=new BMapGL.Point(Y.lng,E.lat);var X=Y.lng>E.lng?(t.getBounds().getNorthEast().lng+E.lng)/2:(t.getBounds().getSouthWest().lng+E.lng)/2;var W=new BMapGL.Point(X,E.lat);q.setPosition(V);o.setInfo(W,U);w.setPosition(V,true);w.updateWindow();A.setPath([E,V])});q.addEventListener("dragging",function(Y){var V=new BMapGL.Point(Y.latLng.lng,E.lat);var X=Y.latLng.lng>E.lng?(t.getBounds().getNorthEast().lng+E.lng)/2:(t.getBounds().getSouthWest().lng+E.lng)/2;var U=Y.latLng.lng>E.lng?true:false;var W=new BMapGL.Point(X,E.lat);Y.target.setPosition(V);o.setInfo(W,L._map.getDistance(E,Y.latLng).toFixed(0));w.setPosition(V,U);A.setPath([E,V]);s=L._map.getDistance(E,Y.latLng).toFixed(0);t.setRadius(L._map.getDistance(E,Y.latLng))});q.addEventListener("dragend",function(U){w.updateWindow()});H.disableEdgeMove();H.removeEventListener("mousemove",z);H.removeEventListener("mousemove",J);e.un(document,"mouseup",G);K.removeOverlay(H)};var J=function(O){e.preventDefault(O);e.stopBubble(O);if(L.controlButton=="right"&&O.button==1){return}if(E==null){I(O)}};var p=function(O){e.preventDefault(O);e.stopBubble(O);K.removeOverlay(b);b=new BMapGL.Label("按下确认中心点，拖拽确认半径",{position:O.point,offset:new BMapGL.Size(10,10)});b.setStyle(L.labelOptions);K.addOverlay(b)};var C=function(O){K.removeOverlay(q);K.removeOverlay(A);K.removeOverlay(o);K.removeOverlay(w)};var y=function(O){E=O.latLng;t.setCenter(O.latLng)};var M=function(O){E=O.latLng;G(O)};H.addEventListener("mousedown",J);H.addEventListener("mousemove",p);if(D){var v=x.getCenter();var r=new BMapGL.Point(x.getBounds().getNorthEast().lng,v.lat);I({point:v});z({point:r});G({})}};j.prototype._bindPolylineOrPolygon=function(w,u){var F=this,E=this._map,y=this._mask,z=[],B=null,C=null,t=null,q=false;function s(){var I=arguments[0];var J=0;var H=0;for(var G=0;G<I.length;G++){if(J<I[G].lng){J=I[G].lng;H=G}}return I[H]}var A=function(H){if(F.controlButton==="right"&&(H.button===1||H.button===0)){return}var G=H.point;if(t){G=t}z.push(G);B=z.concat(z[z.length-1]);if(z.length==1){if(F._drawingType==BMAP_DRAWING_POLYLINE){C=new BMapGL.Polyline(B,F.polylineOptions)}else{if(F._drawingType==BMAP_DRAWING_POLYGON){C=new BMapGL.Polygon(B,F.polygonOptions)}}E.addOverlay(C)}else{C.setPath(B)}if(!q){q=true;y.enableEdgeMove();y.removeEventListener("mousemove",o);y.addEventListener("mousemove",v);y.addEventListener("dblclick",p)}};var v=function(H){var G=H.point;if(F._enableSorption){var I=F.getSorptionMatch(G,F.overlays,F._sorptionDistance);if(I&&I.length>0){t=I[0].point;C.setPositionAt(B.length-1,I[0].point);return}}t=null;C.setPositionAt(B.length-1,H.point);E.removeOverlay(b);b=new BMapGL.Label("单击绘制下一个点，双击完成绘制",{position:H.point,offset:new BMapGL.Size(10,10)});b.setStyle(F.labelOptions);E.addOverlay(b)};var p=function(M){e.stopBubble(M);q=false;E.removeOverlay(b);y.disableEdgeMove();y.removeEventListener("mousedown",A);y.removeEventListener("mousemove",v);y.removeEventListener("mousemove",o);y.removeEventListener("dblclick",p);if(F.controlButton=="right"){z.push(M.point)}else{if(e.ie<=8){}else{z.pop()}}try{if(F._enableGpc&&window.gpcas&&"polygon"===F._drawingType){var O=new gpcas.geometry.PolyDefault();for(var J=0;J<z.length;J++){O.addPoint(new gpcas.Point(z[J].lng,z[J].lat))}for(var I=0;I<F.overlays.length;I++){var R=F.overlays[I].getPath();var N=new gpcas.geometry.PolyDefault();for(var J=0;J<R.length;J++){N.addPoint(new gpcas.Point(R[J].lng,R[J].lat))}var P=O.difference(N);var S=P.getPoints();var Q=[];for(var J=0;J<S.length;J++){Q.push(new BMapGL.Point(S[J].x,S[J].y))}O=new gpcas.geometry.PolyDefault();for(var J=0;J<S.length;J++){O.addPoint(new gpcas.Point(S[J].x,S[J].y))}z=Q}}}catch(M){}C.setPath(z);var G=E.getViewport(z);G.zoom-=1;E.setViewport(G);C.enableEditing();var H=null;if(F.limit){H="polygon"===F._drawingType?F.limit.area:F.limit.distance}var L={limit:H,type:F._drawingType,point:s(z),overlay:C,overlays:[]};var K=new c(L,F);E.addOverlay(K);F._skipEditing();C.addEventListener("lineupdate",function(U){var T=s(U.currentTarget.getPath());K.setPosition(T,true);K.updateWindow()});z.length=0;B.length=0;E.removeOverlay(y)};var o=function(G){e.preventDefault(G);e.stopBubble(G);E.removeOverlay(b);b=new BMapGL.Label("单击确认起点",{position:G.point,offset:new BMapGL.Size(10,10)});b.setStyle(F.labelOptions);E.addOverlay(b)};y.addEventListener("mousemove",o);y.addEventListener("mousedown",A);y.addEventListener("dblclick",function(G){e.stopBubble(G)});if(w){var D=u.getPath();var r=D[D.length-1];for(var x=0;x<D.length;x++){A({point:D[x]})}if(F._drawingType==="polyline"){A({point:r})}p({point:r})}};j.prototype._bindRectangle=function(t,A){var x=this,p=this._map,D=this._mask,z=null,q=null;function w(E,M){var F=new BMapGL.Point(E.lng,E.lat);var L=new BMapGL.Point(M.lng,E.lat);var I=new BMapGL.Point(M.lng,M.lat);var K=new BMapGL.Point(E.lng,M.lat);var N=new BMapGL.Point((E.lng+M.lng)/2,E.lat);
var H=new BMapGL.Point(M.lng,(E.lat+M.lat)/2);var G=new BMapGL.Point((E.lng+M.lng)/2,M.lat);var J=new BMapGL.Point(E.lng,(E.lat+M.lat)/2);return[F,N,L,H,I,G,K,J]}var o=new BMapGL.Icon(n,new BMapGL.Size(10,10));o.setImageSize(new BMapGL.Size(10,10));var s=function(F){e.stopBubble(F);e.preventDefault(F);if(x.controlButton=="right"&&(F.button==1||F.button==0)){return}q=F.point;var E=q;z=new BMapGL.Polygon(x._getRectanglePoint(q,E),x.rectangleOptions);p.addOverlay(z);D.enableEdgeMove();D.addEventListener("mousemove",C);e.on(document,"mouseup",v)};var C=function(H){p.removeOverlay(b);z.setPath(x._getRectanglePoint(q,H.point));var G=w(q,H.point);var F=x._map.getDistance(q,G[2]).toFixed(0);var E=x._map.getDistance(q,G[6]).toFixed(0);b=new BMapGL.Label("尺寸："+F+"米 x "+E+"米<br>松开结束绘制",{position:H.point,offset:new BMapGL.Size(10,10)});b.setStyle(x.labelOptions);p.addOverlay(b)};var v=function(P){D.hide();var Q=null;var K=[];var R=w(q,P.point);var O=[];var H=p.getViewport(R);H.zoom-=1;p.setViewport(H);p.removeOverlay(b);var G=x._map.getDistance(q,R[2]).toFixed(0);var S=x._map.getDistance(q,R[6]).toFixed(0);var F=new l("rectangle",R[0],{width:G,height:S},z,x);for(var M=0;M<R.length;M++){var L=new BMapGL.Marker(R[M]);L.setIcon(o);L.enableDragging();K.push(L);p.addOverlay(L);O[M]=x.mc2ll(L.point);L.addEventListener("mousedown",function(T){Q=x.mc2ll(T.target.point)});L.addEventListener("dragging",function(V){var T=V.latLng;for(var U=0;U<O.length;U++){if(Q.lng==O[U].lng){R[U].lng=T.lng}if(Q.lat==O[U].lat){R[U].lat=T.lat}}R=w(R[0],R[4]);for(var U=0;U<K.length;U++){K[U].setPosition(R[U])}G=x._map.getDistance(R[0],R[2]).toFixed(0);S=x._map.getDistance(R[0],R[6]).toFixed(0);F.setInfo(R[0],{width:G,height:S});N.setPosition(R[3],true);z.setPath(R)});L.addEventListener("dragend",function(V){for(var U=0;U<K.length;U++){var T=K[U];O[U]=x.mc2ll(T.point)}N.updateWindow()})}F.addEventListener("rectwhchange",function(Z){var Y=Z.width;var U=Z.height;var T=i(R[0],Y,"east");var aa=i(R[0],U,"south");R[4].lng=T.lng;R[4].lat=aa.lat;R=w(R[0],R[4]);for(var W=0;W<K.length;W++){K[W].setPosition(R[W])}F.setInfo(R[0],{width:Y,height:U});N.setPosition(R[3],true);z.setPath(R);for(var X=0;X<K.length;X++){var V=K[X];O[X]=x.mc2ll(V.point)}N.updateWindow()});var E=[K,F];var I=null;if(x.limit){I=x.limit.area}var J={limit:I,type:"rectangle",point:R[3],overlay:z,overlays:E};var N=new c(J,x);p.addOverlay(N);p.addOverlay(F);D.disableEdgeMove();D.removeEventListener("mousemove",C);D.removeEventListener("mousemove",B);x._skipEditing();e.un(document,"mouseup",v);p.removeOverlay(D)};var B=function(E){e.preventDefault(E);e.stopBubble(E);p.removeOverlay(b);b=new BMapGL.Label("按住确认起点，拖拽进行绘制",{position:E.point,offset:new BMapGL.Size(10,10)});b.setStyle(x.labelOptions);p.addOverlay(b)};D.addEventListener("mousedown",s);D.addEventListener("mousemove",B);if(t){var y=A.getBounds();var r=y.getSouthWest();var u=y.getNorthEast();s({point:r});C({point:u});v({point:u})}};j.prototype._calculate=function(r,q){var p={data:0,label:null};if(this._enableCalculate&&BMapGLLib.GeoUtils){var s=r.toString();switch(s){case"Polyline":p.data=BMapGLLib.GeoUtils.getPolylineDistance(r);break;case"Polygon":p.data=BMapGLLib.GeoUtils.getPolygonArea(r);break;case"Circle":var o=r.getRadius();p.data=Math.PI*o*o;break}if(!p.data||p.data<0){p.data=0}else{p.data=p.data.toFixed(2)}}return p};j.prototype._addGeoUtilsLibrary=function(){if(!BMapGLLib.GeoUtils){var o=document.createElement("script");o.setAttribute("type","text/javascript");o.setAttribute("src","//mapopen.cdn.bcebos.com/github/BMapGLLib/GeoUtils/src/GeoUtils.min.js");document.body.appendChild(o)}};j.prototype._addGPCLibrary=function(){if(!window.gpcas){var o=document.createElement("script");o.setAttribute("type","text/javascript");o.setAttribute("src","//mapopen.cdn.bcebos.com/github/BMapGLLib/DrawingManager/src/gpc.js");document.body.appendChild(o)}};j.prototype._addLabel=function(o,q){var p=new BMapGL.Label(q,{position:o});this._map.addOverlay(p);return p};j.prototype._getRectanglePoint=function(p,o){return[new BMapGL.Point(p.lng,p.lat),new BMapGL.Point(o.lng,p.lat),new BMapGL.Point(o.lng,o.lat),new BMapGL.Point(p.lng,o.lat)]};j.prototype._dispatchOverlayComplete=function(p,q){var o={overlay:p,drawingMode:this._drawingType};if(q){o.calculate=q.data||null;o.label=q.label||null}this.dispatchEvent(this._drawingType+"complete",p);this.dispatchEvent("overlaycomplete",o)};j.prototype._dispatchOverlayCancel=function(p){var o={overlay:p,drawingMode:this._drawingType};this.dispatchEvent(this._drawingType+"cancel",p);this.dispatchEvent("overlaycancel",o)};j.prototype.getSorptionMatch=function(J,Q,s){s=s||20;var R=this._map;var w=R.pointToPixel(J);var C=[];for(var L=0;L<Q.length;L++){var F=Q[L].getPath();var z=F[0];var D=F[F.length-1];if(!z.equals(D)){F.push(F[0])}for(var N=1;N<F.length;N++){var H=R.pointToPixel(F[N-1]);var G=R.pointToPixel(F[N]);var K=[w.x-H.x,w.y-H.y];var U=[G.x-H.x,G.y-H.y];var p=[G.x-w.x,G.y-w.y];var M=K[0]*U[0]+K[1]*U[1];var v=Math.sqrt(Math.pow(K[0],2)+Math.pow(K[1],2))*Math.sqrt(Math.pow(U[0],2)+Math.pow(U[1],2));
var S=Math.acos(M/v);var o=U[0]*p[0]+U[1]*p[1];var I=Math.sqrt(Math.pow(U[0],2)+Math.pow(U[1],2))*Math.sqrt(Math.pow(p[0],2)+Math.pow(p[1],2));var y=Math.acos(o/I);if(S<Math.PI/2&&y<Math.PI/2){var q=Math.sqrt(Math.pow(K[0],2)+Math.pow(K[1],2));var E=Math.sqrt(Math.pow(U[0],2)+Math.pow(U[1],2));var r=Math.cos(S)*q;var t=r/E;var u=Math.sin(S)*q;var x=[H.x+U[0]*t,H.y+U[1]*t];if(u<s){C.push({point:R.pixelToPoint({x:x[0],y:x[1]}),length:u})}}}}C.sort(function(B,A){return B.length-A.length});var T=C.length>0?C:null;return T};j.prototype.mc2ll=function(o){var q=this._map;var p=q.mercatorToLnglat(o.lng,o.lat);return new BMapGL.Point(p[0],p[1])};j.prototype.ll2mc=function(o){var q=this._map;var p=q.lnglatToMercator(o.lng,o.lat);return new BMapGL.Point(p[0],p[1])};function c(o,p){this.limit=o.limit;this.type=o.type;this.point=o.point;this.overlay=o.overlay;this.overlays=o.overlays;this.DrawingManager=p}c.prototype=new BMapGL.Overlay();c.prototype.dispatchEvent=e.lang.Class.prototype.dispatchEvent;c.prototype.addEventListener=e.lang.Class.prototype.addEventListener;c.prototype.removeEventListener=e.lang.Class.prototype.removeEventListener;c.prototype.initialize=function(s){var r=this;this._map=s;var o=(this.type==="polyline"?"长度":"面积");var q=(this.type==="polyline"?"万米":"万平方米");var t=this.div=document.createElement("div");t.className="operateWindow";var p='<div><span id="confirmOperate"></span><span id="cancelOperate"></span><span id="warnOperate">'+o+"不超过"+this.limit/10000+q+"！</span></div>";t.innerHTML=p;this._map.getPanes().markerPane.appendChild(t);this.updateWindow();this._bind();return t};c.prototype._bind=function(){var q=this;var r=this._map;var o=this.overlay;var p=this.overlays;document.getElementById("confirmOperate").addEventListener("click",function(v){r.removeOverlay(q);if(q.type=="rectangle"){var u=q.DrawingManager._calculate(o,o.getPath());q.DrawingManager.overlays.push(o)}else{if(q.type=="circle"){var u=q.DrawingManager._calculate(o,q.point);q.DrawingManager.overlays.push(o)}else{if(q.type=="polygon"){var u=q.DrawingManager._calculate(o,(o.getPath()));q.DrawingManager.overlays.push(o);o.disableEditing()}else{if(q.type=="polyline"){var u=q.DrawingManager._calculate(o,(o.getPath()));q.DrawingManager.overlays.push(o);o.disableEditing()}}}}q.DrawingManager._dispatchOverlayComplete(o,u);for(var t=0;t<p.length;t++){if(Array.isArray(p[t])){for(var s in p[t]){r.removeOverlay(p[t][s])}}else{r.removeOverlay(p[t])}}q.DrawingManager.close()});document.getElementById("cancelOperate").addEventListener("click",function(u){r.removeOverlay(q);for(var t=0;t<p.length;t++){if(Array.isArray(p[t])){for(var s in p[t]){r.removeOverlay(p[t][s])}}else{r.removeOverlay(p[t])}}r.removeOverlay(o);q.DrawingManager._dispatchOverlayCancel(o);q.DrawingManager.close()})};c.prototype.updateWindow=function(){if(this.domElement===null){return}var p=this.overlay;var o=this.limit;var q;if(this.type=="rectangle"){q=this.DrawingManager._calculate(p,p.getPath())}else{if(this.type=="circle"){q=this.DrawingManager._calculate(p,this.point)}else{if(this.type=="polygon"){q=this.DrawingManager._calculate(p,p.getPath())}else{if(this.type=="polyline"){q=this.DrawingManager._calculate(p,p.getPath())}}}}if(Object.prototype.toString.call(o)==="[object Number]"&&q.data>o){document.getElementById("confirmOperate").style.display="none";document.getElementById("warnOperate").style.display="block"}else{document.getElementById("confirmOperate").style.display="block";document.getElementById("warnOperate").style.display="none"}};c.prototype.setPosition=function(p,o){this.point=p;var r=this._map,q=r.pointToOverlayPixel(this.point);if(o){this.div.classList.remove("operateLeft");this.div.style.left=q.x+15+"px"}else{this.div.classList.add("operateLeft");this.div.style.left=q.x-105+"px"}this.div.style.top=q.y-16+"px"};c.prototype.draw=function(){var p=this._map,o=p.pointToOverlayPixel(this.point);this.div.style.left=o.x+15+"px";this.div.style.top=o.y-16+"px"};function l(q,o,r,p,s){this.type=q;this.point=o;this.number=r;this.overlay=p;this.DrawingManager=s}l.prototype=new BMapGL.Overlay();l.prototype.dispatchEvent=e.lang.Class.prototype.dispatchEvent;l.prototype.addEventListener=e.lang.Class.prototype.addEventListener;l.prototype.removeEventListener=e.lang.Class.prototype.removeEventListener;l.prototype.initialize=function(q){var p=this;this._map=q;var r=this.div=document.createElement("div");r.className="screenshot";if(this.type=="circle"){var o='<div class="circlShot"><span id="screenshotNum">'+this.number+'</span><input id="circleInput" type="text" /><span class="unit">米</span></div>'}else{if(this.type=="rectangle"){var o='<div class="rectWH"><div class="wh"><span id="rectWidth">'+this.number.width+'</span><input id="rectWidthInput" type="text" /></div><span class="multiple">x</span><div class="wh"><span id="rectHeight">'+this.number.height+'</span><input id="rectHeightInput" type="text" /></div><span class="unit">米</span></div>'}}r.innerHTML=o;this._map.getPanes().markerPane.appendChild(r);
this._bind();return r};l.prototype._bind=function(){this.setNumber(this.number);if(this.type=="circle"){this.bindCircleEvent()}else{this.bindRectEvent()}};l.prototype.bindCircleEvent=function(){var p=this;var o=document.getElementById("screenshotNum");var q=document.getElementById("circleInput");o.addEventListener("click",function(r){var s=o.innerText;o.style.display="none";q.value=s;q.style.display="inline-block";q.focus()});q.addEventListener("click",function(r){q.focus()});q.addEventListener("keydown",function(s){if(s.keyCode===13){var t=q.value;q.style.display="none";o.style.display="inline-block";o.innerText=t;var r={radius:t,overlay:p.overlay};p._dispatchRadiusChange(r)}});q.addEventListener("blur",function(s){var t=q.value;q.style.display="none";o.style.display="inline-block";o.innerText=t;var r={radius:t,overlay:p.overlay};p._dispatchRadiusChange(r)})};l.prototype.bindRectEvent=function(){var q=this;var p=document.getElementById("rectWidth");var s=document.getElementById("rectWidthInput");var o=document.getElementById("rectHeight");var r=document.getElementById("rectHeightInput");s.value=p.innerText;r.value=o.innerText;p.addEventListener("click",function(t){var u=p.innerText;p.style.display="none";s.value=u;s.style.display="inline-block";s.focus()});o.addEventListener("click",function(t){var u=o.innerText;o.style.display="none";r.value=u;r.style.display="inline-block";r.focus()});s.addEventListener("click",function(t){s.focus()});r.addEventListener("click",function(t){r.focus()});s.addEventListener("keydown",function(w){if(w.keyCode===13){var u=s.value;var v=r.value;s.style.display="none";r.style.display="none";p.style.display="inline-block";o.style.display="inline-block";p.innerText=u;o.innerText=v;var t={width:u,height:v,overlay:q.overlay};q._dispatchRectWHChange(t)}});r.addEventListener("keydown",function(w){if(w.keyCode===13){var u=s.value;var v=r.value;s.style.display="none";r.style.display="none";p.style.display="inline-block";o.style.display="inline-block";p.innerText=u;o.innerText=v;var t={width:u,height:v,overlay:q.overlay};q._dispatchRectWHChange(t)}})};l.prototype.setInfo=function(o,p){this.setNumber(p);this.setPosition(o)};l.prototype.setNumber=function(o){if(this.type=="circle"){document.getElementById("screenshotNum").textContent=o}else{document.getElementById("rectWidth").textContent=o.width;document.getElementById("rectHeight").textContent=o.height}};l.prototype.setPosition=function(o){this.point=o;var r=this._map,q=this.type,p=r.pointToOverlayPixel(this.point);if(q=="circle"){this.div.style.left=p.x-30+"px";this.div.style.top=p.y-40+"px"}else{if(q=="rectangle"){this.div.style.left=p.x+"px";this.div.style.top=p.y-45+"px"}}};l.prototype.draw=function(){var q=this._map,p=this.type,o=q.pointToOverlayPixel(this.point);if(p=="circle"){this.div.style.left=o.x-30+"px";this.div.style.top=o.y-40+"px"}else{if(p=="rectangle"){this.div.style.left=o.x+"px";this.div.style.top=o.y-45+"px"}}};l.prototype._dispatchRadiusChange=function(o){this.dispatchEvent("radiuschange",o)};l.prototype._dispatchRectWHChange=function(o){this.dispatchEvent("rectwhchange",o)};function h(){this._enableEdgeMove=false}h.prototype=new BMapGL.Overlay();h.prototype.dispatchEvent=e.lang.Class.prototype.dispatchEvent;h.prototype.addEventListener=e.lang.Class.prototype.addEventListener;h.prototype.removeEventListener=e.lang.Class.prototype.removeEventListener;h.prototype.initialize=function(q){var p=this;this._map=q;var r=this.container=document.createElement("div");var o=this._map.getSize();r.style.cssText="position:absolute;background:transparent;cursor:crosshair;width:"+o.width+"px;height:"+o.height+"px";this._map.addEventListener("resize",function(s){p._adjustSize(s.size)});this._map.getPanes().floatPane.appendChild(r);this._bind();return r};h.prototype.draw=function(){var q=this._map,o=q.pixelToPoint(new BMapGL.Pixel(0,0)),p=q.pointToOverlayPixel(o);this.container.style.left=p.x+"px";this.container.style.top=p.y+"px"};h.prototype.enableEdgeMove=function(){this._enableEdgeMove=true};h.prototype.disableEdgeMove=function(){clearInterval(this._edgeMoveTimer);this._enableEdgeMove=false};h.prototype._bind=function(){var t=this,o=this._map,p=this.container,u=null,v=null;var s=function(x){return{x:x.clientX,y:x.clientY}};var r=function(z){var y=z.type;z=e.getEvent(z);point=t.getDrawPoint(z);var A=function(B){z.point=point;t.dispatchEvent(z)};if(y=="mousedown"){u=s(z)}var x=s(z);if(y=="click"){if(Math.abs(x.x-u.x)<5&&Math.abs(x.y-u.y)<5){if(!v||!(Math.abs(x.x-v.x)<5&&Math.abs(x.y-v.y)<5)){A("click");v=s(z)}else{v=null}}}else{A(y)}};var w=["click","mousedown","mousemove","mouseup","dblclick"],q=w.length;while(q--){e.on(p,w[q],r)}e.on(p,"mousemove",function(x){if(t._enableEdgeMove){t.mousemoveAction(x)}})};h.prototype.mousemoveAction=function(v){function o(A){var z=A.clientX,y=A.clientY;if(A.changedTouches){z=A.changedTouches[0].clientX;y=A.changedTouches[0].clientY}return new BMapGL.Pixel(z,y)}var p=this._map,w=this,q=p.pointToPixel(this.getDrawPoint(v)),s=o(v),t=s.x-q.x,r=s.y-q.y;
q=new BMapGL.Pixel((s.x-t),(s.y-r));this._draggingMovePixel=q;var x=p.pixelToPoint(q),u={pixel:q,point:x};this._panByX=this._panByY=0;if(q.x<=20||q.x>=p.width-20||q.y<=50||q.y>=p.height-10){if(q.x<=20){this._panByX=8}else{if(q.x>=p.width-20){this._panByX=-8}}if(q.y<=50){this._panByY=8}else{if(q.y>=p.height-10){this._panByY=-8}}if(!this._edgeMoveTimer){this._edgeMoveTimer=setInterval(function(){p.panBy(w._panByX,w._panByY,{noAnimation:true})},30)}}else{if(this._edgeMoveTimer){clearInterval(this._edgeMoveTimer);this._edgeMoveTimer=null}}};h.prototype._adjustSize=function(o){this.container.style.width=o.width+"px";this.container.style.height=o.height+"px"};h.prototype.getDrawPoint=function(t){var s=this._map,r=e.getTarget(t),p=t.offsetX||t.layerX||0,u=t.offsetY||t.layerY||0;if(r.nodeType!=1){r=r.parentNode}while(r&&r!=s.getContainer()){if(!(r.clientWidth==0&&r.clientHeight==0&&r.offsetParent&&r.offsetParent.nodeName=="TD")){p+=r.offsetLeft||0;u+=r.offsetTop||0}r=r.offsetParent}var q=new BMapGL.Pixel(p,u);var o=s.pixelToPoint(q);return o};function g(p,o){this.drawingManager=p;o=this.drawingToolOptions=o||{};this._opts={};this.defaultAnchor=BMAP_ANCHOR_TOP_LEFT;this.defaultOffset=new BMapGL.Size(10,10);this.defaultDrawingModes=[BMAP_DRAWING_MARKER,BMAP_DRAWING_CIRCLE,BMAP_DRAWING_POLYLINE,BMAP_DRAWING_POLYGON,BMAP_DRAWING_RECTANGLE];if(o.drawingModes){this.drawingModes=o.drawingModes}else{this.drawingModes=this.defaultDrawingModes}if(o.hasCustomStyle){if(o.anchor){this.setAnchor(o.anchor)}if(o.offset){this.setOffset(o.offset)}}}g.prototype=new BMapGL.Control();g.prototype.initialize=function(s){var p=this.container=document.createElement("div");p.className="BMapGLLib_Drawing";var o=this.panel=document.createElement("div");o.className="BMapGLLib_Drawing_panel";if(this.drawingToolOptions&&this.drawingToolOptions.hasCustomStyle&&this.drawingToolOptions.scale){this._setScale(this.drawingToolOptions.scale)}p.appendChild(o);var q=this._generalHtml();o.appendChild(q);var r=this.tip=document.createElement("div");r.className="BMapGLLib_tip";r.innerHTML='<p class="BMapGLLib_tip_title"></p><p class="BMapGLLib_tip_text"></p>';if(this.drawingToolOptions.enableTips===true){o.appendChild(r)}this._bind(o);if(this.drawingToolOptions.customContainer){e.g(this.drawingToolOptions.customContainer).appendChild(p)}else{s.getContainer().appendChild(p)}return p};g.prototype._generalHtml=function(u){var t=this;var p={};p.hander="拖动地图";p[BMAP_DRAWING_MARKER]="画点";p[BMAP_DRAWING_CIRCLE]="圆形工具";p[BMAP_DRAWING_POLYLINE]="画折线";p[BMAP_DRAWING_POLYGON]="多边形工具";p[BMAP_DRAWING_RECTANGLE]="矩形工具";var v=function(x,w){var y=document.createElement("a");y.className=x;y.href="javascript:void(0)";y.setAttribute("drawingType",w);y.setAttribute("onfocus","this.blur()");y.addEventListener("mouseenter",function(A){var z=A.target.getAttribute("drawingType");var B=p[z];if(z==="hander"){t.tip.children[0].innerText=B;t.tip.children[1].innerText="使用鼠标拖动地图"}else{t.tip.className+=" "+z;t.tip.children[0].innerText=B;t.tip.children[1].innerText="使用"+B+"选出目标区域"}t.tip.style.display="block"});y.addEventListener("mouseleave",function(B){var z=B.target.getAttribute("drawingType");var A=" "+t.tip.className.replace(/[\t\r\n]/g,"")+" ";while(A.indexOf(" "+z+" ")>=0){A=A.replace(" "+z+" "," ")}t.tip.className=A.replace(/^\s+|\s+$/g,"");t.tip.style.display="none"});return y};var q=document.createDocumentFragment();for(var r=0,o=this.drawingModes.length;r<o;r++){var s="BMapGLLib_box BMapGLLib_"+this.drawingModes[r];if(r==o-1){s+=" BMapGLLib_last"}q.appendChild(v(s,this.drawingModes[r]))}return q};g.prototype._setScale=function(r){var q=390,o=50,s=-parseInt((q-q*r)/2,10),p=-parseInt((o-o*r)/2,10);this.container.style.cssText=["-moz-transform: scale("+r+");","-o-transform: scale("+r+");","-webkit-transform: scale("+r+");","transform: scale("+r+");","margin-left:"+s+"px;","margin-top:"+p+"px;","*margin-left:0px;","*margin-top:0px;","margin-left:0px\\0;","margin-top:0px\\0;","filter: progid:DXImageTransform.Microsoft.Matrix(","M11="+r+",","M12=0,","M21=0,","M22="+r+",","SizingMethod='auto expand');"].join("")};g.prototype._bind=function(o){var p=this;e.on(this.panel,"click",function(s){var r=e.getTarget(s);var q=r.getAttribute("drawingType");p.setStyleByDrawingMode(q);p._bindEventByDraingMode(q)})};g.prototype.setStyleByDrawingMode=function(p){if(!p){return}var q=this.panel.getElementsByTagName("a");for(var r=0,o=q.length;r<o;r++){var t=q[r];if(t.getAttribute("drawingType")==p){var s="BMapGLLib_box BMapGLLib_"+p+"_hover";if(r==o-1){s+=" BMapGLLib_last"}t.className=s}else{t.className=t.className.replace(/_hover/,"")}}};g.prototype._bindEventByDraingMode=function(o){var q=this;var p=this.drawingManager;if(p._isOpen&&p.getDrawingMode()===o){p.close();p._map.enableDoubleClickZoom()}else{p.setDrawingMode(o);p.open();p._map.disableDoubleClickZoom()}};var a=[];function f(o){var p=a.length;while(p--){if(a[p]!=o){a[p].close()}}}function m(o,v){var E=[];var s=o["lng"],q=o["lat"];var z=v/6378800,u=(Math.PI/180)*q,C=(Math.PI/180)*s;
for(var t=0;t<271;t+=9){var r=(Math.PI/180)*t,A=Math.asin(Math.sin(u)*Math.cos(z)+Math.cos(u)*Math.sin(z)*Math.cos(r)),w=Math.atan2(Math.sin(r)*Math.sin(z)*Math.cos(u),Math.cos(z)-Math.sin(u)*Math.sin(A)),B=((C-w+Math.PI)%(2*Math.PI))-Math.PI,D=new BMapGL.Point(B*(180/Math.PI),A*(180/Math.PI));E.push(D)}var p=E[0];E.push(new BMapGL.Point(p["lng"],p["lat"]));return E}function i(p,o,D){var s=p["lng"],q=p["lat"];var A=o/6378800,u=(Math.PI/180)*q,E=(Math.PI/180)*s;var t,w,v;switch(D){case"North":case"north":case"N":case"n":t=0;w=p.lng;break;case"West":case"west":case"W":case"w":t=90;v=p.lat;break;case"South":case"south":case"S":case"s":t=180;w=p.lng;break;case"East":case"east":case"E":case"e":t=270;v=p.lat;break;default:t=~~D;break}var r=(Math.PI/180)*t,B=Math.asin(Math.sin(u)*Math.cos(A)+Math.cos(u)*Math.sin(A)*Math.cos(r)),z=Math.atan2(Math.sin(r)*Math.sin(A)*Math.cos(u),Math.cos(A)-Math.sin(u)*Math.sin(B)),C=((E-z+Math.PI)%(2*Math.PI))-Math.PI,F=new BMapGL.Point(w||C*(180/Math.PI),v||B*(180/Math.PI));F.lng=parseFloat(F.lng.toFixed(6));F.lat=parseFloat(F.lat.toFixed(6));return F}})();
