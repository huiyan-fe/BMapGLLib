var BMapGLLib=window.BMapGLLib=BMapGLLib||{},BMAP_DRAWING_MARKER="marker",BMAP_DRAWING_POLYLINE="polyline",BMAP_DRAWING_CIRCLE="circle",BMAP_DRAWING_RECTANGLE="rectangle",BMAP_DRAWING_POLYGON="polygon";!function(){function e(e,t){this.limit=e.limit,this.type=e.type,this.point=e.point,this.overlay=e.overlay,this.overlays=e.overlays,this.DrawingManager=t}function t(e,t,n,i,a){this.type=e,this.point=t,this.number=n,this.overlay=i,this.DrawingManager=a}function n(e){this._enableEdgeMove=!1,this._eventMapping=e.eventMapping}function i(e,t){this.drawingManager=e,t=this.drawingToolOptions=t||{},this._opts={},this.defaultAnchor=BMAP_ANCHOR_TOP_LEFT,this.defaultOffset=new BMapGL.Size(10,10),this.defaultDrawingModes=[BMAP_DRAWING_MARKER,BMAP_DRAWING_CIRCLE,BMAP_DRAWING_POLYLINE,BMAP_DRAWING_POLYGON,BMAP_DRAWING_RECTANGLE],t.drawingModes?this.drawingModes=t.drawingModes:this.drawingModes=this.defaultDrawingModes,t.hasCustomStyle&&(t.anchor&&this.setAnchor(t.anchor),t.offset&&this.setOffset(t.offset))}function a(e){for(var t=p.length;t--;)p[t]!=e&&p[t].close()}function o(e,t,n){var i,a,o,r=e.lng,s=e.lat,l=t/6378800,p=Math.PI/180*s,c=Math.PI/180*r;switch(n){case"North":case"north":case"N":case"n":i=0,a=e.lng;break;case"West":case"west":case"W":case"w":i=90,o=e.lat;break;case"South":case"south":case"S":case"s":i=180,a=e.lng;break;case"East":case"east":case"E":case"e":i=270,o=e.lat;break;default:i=~~n}var d=Math.PI/180*i,g=Math.asin(Math.sin(p)*Math.cos(l)+Math.cos(p)*Math.sin(l)*Math.cos(d)),h=Math.atan2(Math.sin(d)*Math.sin(l)*Math.cos(p),Math.cos(l)-Math.sin(p)*Math.sin(g)),v=(c-h+Math.PI)%(2*Math.PI)-Math.PI,u=new BMapGL.Point(a||v*(180/Math.PI),o||g*(180/Math.PI));return u.lng=parseFloat(u.lng.toFixed(6)),u.lat=parseFloat(u.lat.toFixed(6)),u}var r=r||{guid:"$BAIDU$"};!function(){window[r.guid]={},r.extend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},r.lang=r.lang||{},r.lang.guid=function(){return"TANGRAM__"+(window[r.guid]._counter++).toString(36)},window[r.guid]._counter=window[r.guid]._counter||1,window[r.guid]._instances=window[r.guid]._instances||{},r.lang.Class=function(e){this.guid=e||r.lang.guid(),window[r.guid]._instances[this.guid]=this},window[r.guid]._instances=window[r.guid]._instances||{},r.lang.isString=function(e){return"[object String]"==Object.prototype.toString.call(e)},r.lang.isFunction=function(e){return"[object Function]"==Object.prototype.toString.call(e)},r.lang.Class.prototype.toString=function(){return"[object "+(this._className||"Object")+"]"},r.lang.Class.prototype.dispose=function(){delete window[r.guid]._instances[this.guid];for(var e in this)r.lang.isFunction(this[e])||delete this[e];this.disposed=!0},r.lang.Event=function(e,t){this.type=e,this.returnValue=!0,this.target=t||null,this.currentTarget=null},r.lang.Class.prototype.addEventListener=function(e,t,n){if(r.lang.isFunction(t)){!this.__listeners&&(this.__listeners={});var i,a=this.__listeners;if("string"==typeof n&&n){if(/[^\w\-]/.test(n))throw"nonstandard key:"+n;t.hashCode=n,i=n}0!=e.indexOf("on")&&(e="on"+e),"object"!=typeof a[e]&&(a[e]={}),i=i||r.lang.guid(),t.hashCode=i,a[e][i]=t}},r.lang.Class.prototype.removeEventListener=function(e,t){if(r.lang.isFunction(t))t=t.hashCode;else if(!r.lang.isString(t))return;!this.__listeners&&(this.__listeners={}),0!=e.indexOf("on")&&(e="on"+e);var n=this.__listeners;n[e]&&n[e][t]&&delete n[e][t]},r.lang.Class.prototype.dispatchEvent=function(e,t){r.lang.isString(e)&&(e=new r.lang.Event(e)),!this.__listeners&&(this.__listeners={}),t=t||{};for(var n in t)e[n]=t[n];var n,i=this.__listeners,a=e.type;if(e.target=e.target||this,e.currentTarget=this,0!=a.indexOf("on")&&(a="on"+a),r.lang.isFunction(this[a])&&this[a].apply(this,arguments),"object"==typeof i[a])for(n in i[a])i[a][n].apply(this,arguments);return e.returnValue},r.lang.inherits=function(e,t,n){var i,a,o=e.prototype,r=new Function;r.prototype=t.prototype,a=e.prototype=new r;for(i in o)a[i]=o[i];e.prototype.constructor=e,e.superClass=t.prototype,"string"==typeof n&&(a._className=n)},r.dom=r.dom||{},r._g=r.dom._g=function(e){return r.lang.isString(e)?document.getElementById(e):e},r.g=r.dom.g=function(e){return"string"==typeof e||e instanceof String?document.getElementById(e):e&&e.nodeName&&(1==e.nodeType||9==e.nodeType)?e:null},r.insertHTML=r.dom.insertHTML=function(e,t,n){e=r.dom.g(e);var i,a;return e.insertAdjacentHTML?e.insertAdjacentHTML(t,n):(i=e.ownerDocument.createRange(),t=t.toUpperCase(),"AFTERBEGIN"==t||"BEFOREEND"==t?(i.selectNodeContents(e),i.collapse("AFTERBEGIN"==t)):(a="BEFOREBEGIN"==t,i[a?"setStartBefore":"setEndAfter"](e),i.collapse(a)),i.insertNode(i.createContextualFragment(n))),e},r.ac=r.dom.addClass=function(e,t){e=r.dom.g(e);for(var n=t.split(/\s+/),i=e.className,a=" "+i+" ",o=0,s=n.length;o<s;o++)a.indexOf(" "+n[o]+" ")<0&&(i+=(i?" ":"")+n[o]);return e.className=i,e},r.event=r.event||{},r.event._listeners=r.event._listeners||[],r.on=r.event.on=function(e,t,n){t=t.replace(/^on/i,""),e=r._g(e);var i,a=function(t){n.call(e,t)},o=r.event._listeners,s=r.event._eventFilter,l=t;return t=t.toLowerCase(),s&&s[t]&&(i=s[t](e,t,a),l=i.type,a=i.listener),e.addEventListener?e.addEventListener(l,a,!1):e.attachEvent&&e.attachEvent("on"+l,a),o[o.length]=[e,t,n,a,l],e},r.un=r.event.un=function(e,t,n){e=r._g(e),t=t.replace(/^on/i,"").toLowerCase();for(var i,a,o,s=r.event._listeners,l=s.length,p=!n;l--;)i=s[l],i[1]!==t||i[0]!==e||!p&&i[2]!==n||(a=i[4],o=i[3],e.removeEventListener?e.removeEventListener(a,o,!1):e.detachEvent&&e.detachEvent("on"+a,o),s.splice(l,1));return e},r.getEvent=r.event.getEvent=function(e){return window.event||e},r.getTarget=r.event.getTarget=function(e){var e=r.getEvent(e);return e.target||e.srcElement},r.preventDefault=r.event.preventDefault=function(e){var e=r.getEvent(e);e.preventDefault?e.preventDefault():e.returnValue=!1},r.stopBubble=r.event.stopBubble=function(e){e=r.getEvent(e),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},r.browser=r.browser||{},/msie (\d+\.\d)/i.test(navigator.userAgent)&&(r.browser.ie=r.ie=document.documentMode||+RegExp.$1)}();var s=BMapGLLib.DrawingManager=function(e,t){if(e){p.push(this),t=t||{},this.overlays=[];var n=(window.PointerEvent||window.MSPointerEvent)&&(navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0),i={mousedown:"mousedown",mousemove:"mousemove",mouseup:"mouseup"};n&&(window.PointerEvent?(i.mousedown="pointerdown",i.mousemove="pointermove",i.mouseup="pointerup"):window.MSPointerEvent&&(i.mousedown="MSPointerDown",i.mousemove="MSPointerMove",i.mouseup="MSPointerUp")),this._eventMapping=i,this._initialize(e,t)}};r.lang.inherits(s,r.lang.Class,"DrawingManager"),s.prototype.open=function(){if(1==this._isOpen)return!0;a(this),this._open()},s.prototype.close=function(){if(0==this._isOpen)return!0;var e=this;this._close(),e._map.removeOverlay(l),setTimeout(function(){e._map.enableDoubleClickZoom()},2e3)},s.prototype.setDrawingMode=function(e){this._drawingType!=e&&(a(this),this._setDrawingMode(e))},s.prototype.getDrawingMode=function(){return this._drawingType},s.prototype.enableCalculate=function(){this._enableCalculate=!0,this._addGeoUtilsLibrary()},s.prototype.disableCalculate=function(){this._enableCalculate=!1},s.prototype.enableSorption=function(){this._enableSorption=!0},s.prototype.disableSorption=function(){this._enableSorption=!1},s.prototype.enableGpc=function(){this._enableGpc=!0,this._addGPCLibrary()},s.prototype.disableGpc=function(){this._enableGpc=!1},s.prototype.getOverlays=function(){return this.overlays},s.prototype.addOverlayData=function(e){return this.overlays.push(e)},s.prototype.setOverlaysData=function(e){return this.overlays=e},s.prototype.clearOverlayData=function(e){for(var t=(this._map,0);t<this.overlays.length;t++)if(this.overlays[t]===e)return this.overlays.splice(t,1),e},s.prototype.clearOverlay=function(e){var t=this._map,e=this.clearOverlayData(e);e&&t.removeOverlay(e)},s.prototype.clearOverlays=function(){var e=this._map;this.overlays.forEach(function(t){e.removeOverlay(t)}),this.overlays.length=0},s.prototype.setOverlayEdit=function(e,t){["circle","rectangle","polygon","polyline"].includes(e)?(this.clearOverlay(t),this._map.removeOverlay(t),this._drawingType=e,this._open(!0,t)):console.error("暂不支持的编辑类型",e)},s.prototype._initialize=function(e,t){if(this._map=e,this._opts=t,this._opts.confirmVisible=t.confirmVisible!==!1,this._opts.autoViewport=t.autoViewport!==!1,this._drawingType=t.drawingMode||BMAP_DRAWING_MARKER,t.enableDrawingTool&&this.enableDrawingTool(),void 0!==t.sorptionDistance&&this.setSorptionDistance(t.sorptionDistance),t.sorpOverlays&&this.setSorpOverlays(t.sorpOverlays),t.enableCalculate===!0?this.enableCalculate():this.disableCalculate(),t.enableLimit===!0){var n=t.limitOptions;this.limit=n}t.enableSorption===!0?this.enableSorption():this.disableSorption(),t.enableGpc===!0?this.enableGpc():this.disableGpc(),this._isOpen=!(t.isOpen!==!0),this._isOpen&&this._open(),this.setPolygonOptions(t.polygonOptions),this.setMarkerOptions(t.markerOptions),this.setCircleOptions(t.circleOptions),this.setPolylineOptions(t.polylineOptions),this.setRectangleOptions(t.rectangleOptions),this.setLabelOptions(t.labelOptions),this.controlButton="right"==t.controlButton?"right":"left",this.skipEditing=void 0!==t.skipEditing&&t.skipEditing},s.prototype.enableDrawingTool=function(){var e=this._opts;if(!this._drawingTool){var t=new i(this,e.drawingToolOptions);this._drawingTool=t}this._map.addControl(this._drawingTool)},s.prototype.disableDrawingTool=function(){this._drawingTool&&this._map.removeControl(this._drawingTool)},s.prototype.setSorptionDistance=function(e){this._sorptionDistance=e||0},s.prototype.setSorpOverlays=function(e){this._sorpOverlays=e||[]},s.prototype.setPolygonOptions=function(e){this.polygonOptions=e||{}},s.prototype.setMarkerOptions=function(e){this.markerOptions=e||{}},s.prototype.setCircleOptions=function(e){this.circleOptions=e||{}},s.prototype.setPolylineOptions=function(e){this.polylineOptions=e||{}},s.prototype.setRectangleOptions=function(e){this.rectangleOptions=e||{}},s.prototype.setLabelOptions=function(e){this.labelOptions=e||{}},s.prototype._open=function(e,t){this._isOpen=!0,this._mask||(this._mask=new n({eventMapping:this._eventMapping})),this._map.addOverlay(this._mask),this._setDrawingMode(this._drawingType,e,t)},s.prototype._setDrawingMode=function(e,t,n){if(this._drawingType=e,this._isOpen)switch(this._mask.__listeners={},e){case BMAP_DRAWING_MARKER:this._bindMarker();break;case BMAP_DRAWING_CIRCLE:this._bindCircle(t,n);break;case BMAP_DRAWING_POLYLINE:case BMAP_DRAWING_POLYGON:this._bindPolylineOrPolygon(t,n);break;case BMAP_DRAWING_RECTANGLE:this._bindRectangle(t,n)}this._drawingTool&&this._isOpen&&this._drawingTool.setStyleByDrawingMode(e)},s.prototype._close=function(){this._isOpen=!1,this._mask&&this._map.removeOverlay(this._mask),this._drawingTool&&this._drawingTool.setStyleByDrawingMode("hander")},s.prototype._skipEditing=function(){var e=this[this._drawingType+"Options"],t=this.skipEditing,n=null;e&&(n=void 0===e.skipEditing?n:e.skipEditing),(n||t)&&n!==!1&&document.getElementById("confirmOperate").click()},s.prototype._bindMarker=function(){var e=this,t=this._map,n=this._mask,i=function(n){var i=new BMapGL.Marker(n.point,e.markerOptions);t.addOverlay(i),e.addOverlayData(i),e._dispatchOverlayComplete(i)};n.addEventListener("click",i)};var l=null;s.prototype._bindCircle=function(n,i){var a=this,s=this._map,p=this._mask,c=null,d=[],g=null,h=1,v=null,u=null,y=null,m=null,f={strokeColor:"#4E6DF1",strokeWeight:2},M=new BMapGL.Icon("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAAXNSR0IArs4c6QAAAs1JREFUWAnNmb9v01AQx989SzVI8dIBJNZ27Mb/QRpExMiOKAW1Mw3MRVCB2BlRECF/CBtjuwbBwGJL1JXs474vtuU4Tkho4tyTGr9ffvfxvV93VzL/mfYPLndSumqT4buG6Y4MI3+MpyQayc/IEI/Y0DfLW8Ov725cuKYlf2iZ/p3j8FZylT4hQx1m3lvmXSL6zoYH3pZ9PzgNfi367kKA3R634t/REXF6zMa0Fh28rp8IjJjsqb/det3vUVTXp1z3T8DOs/B+kvIHw3y7/OK180Q/PUuPB2+DL/PGsrMaZQrp3tPwJEn488rhIFQ+GGNDBmTN4qht6D7nm3ESfpRBurNeXGk9Ud/3gkf9N/SnOu6UBvE1jcKBSBQBmXWanAJsH0YvGtNcWV0C6WSX6yQ/McVuQ2DNycFW6ddQkdjz6EF54xQg46MkPMfibYimXozsbn872M2PoGKKcc5tHA7IoiDHkuE7DeKGSOP04rqHcL1Klq8VqMj6dgc3jtMgx+mBFjh8DlhwpSI/BiTaR0FTwn0PHnJWiYnPNcHlLNb4uxYmU16h7Qk26+w5bWQZD9hsZmzqRBRDGJsks4JVMgIwN9M1ArIAykRrRHNMwoY1+EMtoLBhDcID05pGMsWsF1DYLPxWrepzPjWcaq2AYLPw+OFUa4MEE9jG1ox4/NoAEYUAkwNEOAJGohZIsICpAITlinCEFkCw5PEbp0GAIVZixGHZOKRzmoQlSwUgvCjESsSG3eDVJ26nMOQeHRgLQBScP0r0EvmNJJFd9onBIOtxMiH80D4MPzUeXZD4zPAseCjHy8QMTmgQqOiAQI5k+pPoayxlwaMqnOOZJXasSRenOVlfKES0JdM6PGu9qoObC5iDqw1g5oBYtIiVGLK9VRzmbgwZC2NWN0Qus/yc2iTlxmoeIRIXhRBHX5bAXrV9XlmmcH1B9DrBTf0b4i99lUEMOuku/wAAAABJRU5ErkJggg==",new BMapGL.Size(20,20)),w=new BMapGL.Icon("data:image/png;base64,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",new BMapGL.Size(40,20),{imageOffset:new BMapGL.Size(0,10)}),_=function(e){if("right"!=a.controlButton||1!=e.button&&0!=e.button){g=e.point;var t=new BMapGL.Marker(g);M.setImageSize(new BMapGL.Size(20,20)),t.setIcon(M),t.enableDragging(),t.addEventListener("dragstart",B),t.addEventListener("dragging",O),t.addEventListener("dragend",P),s.addOverlay(t),d.push(t),c=new BMapGL.Circle(g,h,a.circleOptions),s.addOverlay(c),p.enableEdgeMove(),p.addEventListener(a._eventMapping.mousemove,b),r.on(document,a._eventMapping.mouseup,L)}},b=function(e){h=a._map.getDistance(g,e.point).toFixed(0),c.setRadius(h),s.removeOverlay(l),l=new BMapGL.Label("半径："+h+"米<br>松开完成绘制",{position:e.point,offset:new BMapGL.Size(10,10)}),l.setStyle(a.labelOptions),s.addOverlay(l)},L=function(n){var i=s.getViewport(c.getBounds());i.zoom-=1,a._opts.autoViewport&&s.setViewport(i),s.removeOverlay(l);var M=new BMapGL.Point(c.getBounds().getNorthEast().lng,g.lat);p.hide(),v=new BMapGL.Marker(M),v.setIcon(w),v.enableDragging(),u=new BMapGL.Polyline([g,M],f),y=new t("circle",new BMapGL.Point((c.getBounds().getNorthEast().lng+g.lng)/2,g.lat),h,c,a),d=d.concat([v,u,y]);var _=null;a.limit&&(_=a.limit.area);var A={limit:_,type:"circle",point:M,overlay:c,overlays:d},B=a._opts.confirmVisible;if(B&&(m=new e(A,a),s.addOverlay(m)),s.addOverlay(v),s.addOverlay(u),s.addOverlay(y),a._skipEditing(),y.addEventListener("radiuschange",function(e){var t=e.radius;c.setRadius(t);var n=o(g,t,"east"),i=new BMapGL.Point(n.lng,g.lat),a=n.lng>g.lng?(c.getBounds().getNorthEast().lng+g.lng)/2:(c.getBounds().getSouthWest().lng+g.lng)/2,r=new BMapGL.Point(a,g.lat);v.setPosition(i),y.setInfo(r,t),B&&(m.setPosition(i,!0),m.updateWindow()),u.setPath([g,i])}),v.addEventListener("dragging",function(e){var t=new BMapGL.Point(e.latLng.lng,g.lat),n=e.latLng.lng>g.lng?(c.getBounds().getNorthEast().lng+g.lng)/2:(c.getBounds().getSouthWest().lng+g.lng)/2,i=e.latLng.lng>g.lng,o=new BMapGL.Point(n,g.lat);e.target.setPosition(t),y.setInfo(o,a._map.getDistance(g,e.latLng).toFixed(0)),B&&m.setPosition(t,i),u.setPath([g,t]),h=a._map.getDistance(g,e.latLng).toFixed(0),c.setRadius(a._map.getDistance(g,e.latLng))}),v.addEventListener("dragend",function(e){B&&m.updateWindow()}),p.disableEdgeMove(),p.removeEventListener(a._eventMapping.mousemove,b),p.removeEventListener(a._eventMapping.mousemove,E),r.un(document,a._eventMapping.mouseup,L),s.removeOverlay(p),!B){var O=a._calculate(c);a.overlays.push(c),a._dispatchOverlayComplete(c,O);for(var P=0;P<d.length;P++)if(Array.isArray(d[P]))for(var G in d[P])s.removeOverlay(d[P][G]);else s.removeOverlay(d[P]);a.close()}},E=function(e){r.preventDefault(e),r.stopBubble(e),"right"==a.controlButton&&1==e.button||null==g&&_(e)},A=function(e){r.preventDefault(e),r.stopBubble(e),s.removeOverlay(l),l=new BMapGL.Label("按下确认中心点，拖拽确认半径",{position:e.point,offset:new BMapGL.Size(10,10)}),l.setStyle(a.labelOptions),s.addOverlay(l)},B=function(e){s.removeOverlay(v),s.removeOverlay(u),s.removeOverlay(y),s.removeOverlay(m)},O=function(e){g=e.latLng,c.setCenter(e.latLng)},P=function(e){g=e.latLng,L(e)};if(p.addEventListener(a._eventMapping.mousedown,E),p.addEventListener(a._eventMapping.mousemove,A),n){var G=i.getCenter(),x=new BMapGL.Point(i.getBounds().getNorthEast().lng,G.lat);_({point:G}),b({point:x}),L({})}},s.prototype._bindPolylineOrPolygon=function(t,n){function i(){for(var e=arguments[0],t=0,n=0,i=0;i<e.length;i++)t<e[i].lng&&(t=e[i].lng,n=i);return e[n]}var a=this,o=this._map,s=this._mask,p=[],c=null,d=null,g=null,h=!1,v=function(e){if("right"!==a.controlButton||1!==e.button&&0!==e.button){var t=e.point;g&&(t=g),p.push(t),c=p.concat(p[p.length-1]),1==p.length?(a._drawingType==BMAP_DRAWING_POLYLINE?d=new BMapGL.Polyline(c,a.polylineOptions):a._drawingType==BMAP_DRAWING_POLYGON&&(d=new BMapGL.Polygon(c,a.polygonOptions)),o.addOverlay(d)):d.setPath(c),h||(h=!0,s.enableEdgeMove(),s.removeEventListener(a._eventMapping.mousemove,m),s.addEventListener(a._eventMapping.mousemove,u),s.addEventListener("dblclick",y))}},u=function(e){var t=e.point;if(a._enableSorption){var n=a.getSorptionMatch(t,a.overlays,a._sorptionDistance);if(n&&n.length>0)return g=n[0].point,void d.setPositionAt(c.length-1,n[0].point);if(a._sorpOverlays){var i=a.getSorptionMatch(t,a._sorpOverlays,a._sorptionDistance);if(i&&i.length>0)return g=i[0].point,void d.setPositionAt(c.length-1,i[0].point)}}g=null,d.setPositionAt(c.length-1,e.point),o.removeOverlay(l),l=new BMapGL.Label("单击绘制下一个点，双击完成绘制",{position:e.point,offset:new BMapGL.Size(10,10)}),l.setStyle(a.labelOptions),o.addOverlay(l)},y=function(t){r.stopBubble(t),h=!1,o.removeOverlay(l),s.disableEdgeMove(),s.removeEventListener(a._eventMapping.mousedown,v),s.removeEventListener(a._eventMapping.mousemove,u),s.removeEventListener(a._eventMapping.mousemove,m),s.removeEventListener("dblclick",y),"right"==a.controlButton?p.push(t.point):r.ie<=8||p.pop();try{if(a._enableGpc&&window.gpcas&&"polygon"===a._drawingType){for(var n=new gpcas.geometry.PolyDefault,g=0;g<p.length;g++)n.addPoint(new gpcas.Point(p[g].lng,p[g].lat));for(var f=0;f<a.overlays.length;f++){for(var M=a.overlays[f].getPath(),w=new gpcas.geometry.PolyDefault,g=0;g<M.length;g++)w.addPoint(new gpcas.Point(M[g].lng,M[g].lat));for(var _=n.difference(w),b=_.getPoints(),L=[],g=0;g<b.length;g++)L.push(new BMapGL.Point(b[g].x,b[g].y));n=new gpcas.geometry.PolyDefault;for(var g=0;g<b.length;g++)n.addPoint(new gpcas.Point(b[g].x,b[g].y));p=L}}}catch(e){}d.setPath(p);var E=o.getViewport(p);E.zoom-=1,a._opts.autoViewport&&o.setViewport(E),d.enableEditing();var A=null;a.limit&&(A="polygon"===a._drawingType?a.limit.area:a.limit.distance);var B,O={limit:A,type:a._drawingType,point:i(p),overlay:d,overlays:[]},P=a._opts.confirmVisible;if(P&&(B=new e(O,a),o.addOverlay(B)),a._skipEditing(),d.addEventListener("lineupdate",function(e){var t=i(e.currentTarget.getPath());P&&(B.setPosition(t,!0),B.updateWindow())}),p.length=0,c.length=0,o.removeOverlay(s),!P){var G=a._calculate(d);a.overlays.push(d),a._dispatchOverlayComplete(d,G),d.disableEditing(),a.close()}},m=function(e){r.preventDefault(e),r.stopBubble(e),o.removeOverlay(l),l=new BMapGL.Label("单击确认起点",{position:e.point,offset:new BMapGL.Size(10,10)}),l.setStyle(a.labelOptions),o.addOverlay(l)};if(s.addEventListener(a._eventMapping.mousemove,m),s.addEventListener(a._eventMapping.mousedown,v),s.addEventListener("dblclick",function(e){r.stopBubble(e)}),t){for(var f=n.getPath(),M=f[f.length-1],w=0;w<f.length;w++)v({point:f[w]});"polyline"===a._drawingType&&v({point:M}),y({point:M})}},s.prototype._bindRectangle=function(n,i){function a(e,t){var n=new BMapGL.Point(e.lng,e.lat),i=new BMapGL.Point(t.lng,e.lat),a=new BMapGL.Point(t.lng,t.lat),o=new BMapGL.Point(e.lng,t.lat);return[n,new BMapGL.Point((e.lng+t.lng)/2,e.lat),i,new BMapGL.Point(t.lng,(e.lat+t.lat)/2),a,new BMapGL.Point((e.lng+t.lng)/2,t.lat),o,new BMapGL.Point(e.lng,(e.lat+t.lat)/2)]}var s=this,p=this._map,c=this._mask,d=null,g=null,h=new BMapGL.Icon("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAd9JREFUOBGtVc8rRFEUPufOvELMguTHwkbKjxRlo9gqNpjyFyhTit3I8i1ldpQa5S9QmA1lS9koSn6UZmMxSCyGkPlx3O+9mTe8Zl4zw7eZ7rnn++aee893HlMRzEXFeLh6m2LJTpHwEJG022mcIJZTYbXX2lu/txnilJvO7sDkYnJaC0REqNO993PNTHEiDsfWAru/4vmFaYo6e35dEZIwYh1tPhobNmig20/NjcpKe3rJ0vlNmg5PUnR3n7FiTBwZbGpYNk3OIuCccHIhuQoxv49lNljD4yMG6VMUhT49HRynaGvnU9IZ0Wkcia0HlhxBlCkiOxAz5+u4v8tXVMgdvLjNkLnxbosyB1E+4wEeL5PXuLPQTC1NjBpunud6/yhF0e0PVBNv6Qv0KLwmxHBnKLNSgAMuNKClrNbQKniAUnfm9SfggAtAS9l9RtZrehG99tAJFnTP6n6wmzbfGl7EUnsFrrTbDVYqs4q4FtR20kDTVosClxMK3oQQHFAtHK7WUjA6hGAnOKBSgAMuAC2FqYGmhDdhp0oBDrjQgJayRxBbAwHehJ3KBXLBsfM5DC3H/v81HHIdSYQRpMcX6ekRhjcPjr/KGV+6Unt8xXJlOSfMl/lvAzYviN+/fAK+AW5jAVefzjWGAAAAAElFTkSuQmCC",new BMapGL.Size(10,10));h.setImageSize(new BMapGL.Size(10,10));var v=function(e){if(r.stopBubble(e),r.preventDefault(e),"right"!=s.controlButton||1!=e.button&&0!=e.button){g=e.point;var t=g;d=new BMapGL.Polygon(s._getRectanglePoint(g,t),s.rectangleOptions),p.addOverlay(d),c.enableEdgeMove(),c.addEventListener(s._eventMapping.mousemove,u),r.on(document,s._eventMapping.mouseup,y)}},u=function(e){p.removeOverlay(l),d.setPath(s._getRectanglePoint(g,e.point));var t=a(g,e.point),n=s._map.getDistance(g,t[2]).toFixed(0),i=s._map.getDistance(g,t[6]).toFixed(0);l=new BMapGL.Label("尺寸："+n+"米 x "+i+"米<br>松开结束绘制",{position:e.point,offset:new BMapGL.Size(10,10)}),l.setStyle(s.labelOptions),p.addOverlay(l)},y=function(n){c.hide();var i,v=null,f=[],M=a(g,n.point),w=[],_=p.getViewport(M),b=s._opts.confirmVisible;_.zoom-=1,s._opts.autoViewport&&p.setViewport(_),p.removeOverlay(l);for(var L=s._map.getDistance(g,M[2]).toFixed(0),E=s._map.getDistance(g,M[6]).toFixed(0),A=new t("rectangle",M[0],{width:L,height:E},d,s),B=0;B<M.length;B++){var O=new BMapGL.Marker(M[B]);O.setIcon(h),O.enableDragging(),f.push(O),p.addOverlay(O),w[B]=s.mc2ll(O.point),O.addEventListener("mousedown",function(e){v=s.mc2ll(e.target.point)}),O.addEventListener("dragging",function(e){for(var t=e.latLng,n=0;n<w.length;n++)Math.abs(v.lng-w[n].lng)<1e-6&&(M[n].lng=t.lng),Math.abs(v.lat-w[n].lat)<1e-6&&(M[n].lat=t.lat);M=a(M[0],M[4]);for(var n=0;n<f.length;n++)f[n].setPosition(M[n]);L=s._map.getDistance(M[0],M[2]).toFixed(0),E=s._map.getDistance(M[0],M[6]).toFixed(0),A.setInfo(M[0],{width:L,height:E}),b&&i.setPosition(M[3],!0),d.setPath(M)}),O.addEventListener("dragend",function(e){for(var t=0;t<f.length;t++){var n=f[t];w[t]=s.mc2ll(n.point)}b&&i.updateWindow()})}A.addEventListener("rectwhchange",function(e){var t=e.width,n=e.height,r=o(M[0],t,"east"),l=o(M[0],n,"south");M[4].lng=r.lng,M[4].lat=l.lat,M=a(M[0],M[4]);for(var p=0;p<f.length;p++)f[p].setPosition(M[p]);A.setInfo(M[0],{width:t,height:n}),b&&i.setPosition(M[3],!0),d.setPath(M);for(var c=0;c<f.length;c++){var g=f[c];w[c]=s.mc2ll(g.point)}b&&i.updateWindow()});var P=[f,A],G=null;s.limit&&(G=s.limit.area);var x={limit:G,type:"rectangle",point:M[3],overlay:d,overlays:P};if(b&&(i=new e(x,s),p.addOverlay(i)),p.addOverlay(A),c.disableEdgeMove(),c.removeEventListener(s._eventMapping.mousemove,u),c.removeEventListener(s._eventMapping.mousemove,m),s._skipEditing(),r.un(document,s._eventMapping.mouseup,y),p.removeOverlay(c),!b){var T=s._calculate(d);s.overlays.push(d),s._dispatchOverlayComplete(d,T);for(var B=0;B<P.length;B++)if(Array.isArray(P[B]))for(var D in P[B])p.removeOverlay(P[B][D]);else p.removeOverlay(P[B]);s.close()}},m=function(e){r.preventDefault(e),r.stopBubble(e),p.removeOverlay(l),l=new BMapGL.Label("按住确认起点，拖拽进行绘制",{position:e.point,offset:new BMapGL.Size(10,10)}),l.setStyle(s.labelOptions),p.addOverlay(l)};if(c.addEventListener(s._eventMapping.mousedown,v),c.addEventListener(s._eventMapping.mousemove,m),n){var f=i.getBounds(),M=f.getSouthWest(),w=f.getNorthEast();v({point:M}),u({point:w}),y({point:w})}},s.prototype._calculate=function(e,t){var n={data:0,label:null};if(this._enableCalculate&&BMapGLLib.GeoUtils){switch(e.toString()){case"Polyline":n.data=BMapGLLib.GeoUtils.getPolylineDistance(e);break;case"Polygon":n.data=BMapGLLib.GeoUtils.getPolygonArea(e);break;case"Circle":var i=e.getRadius();n.data=Math.PI*i*i}!n.data||n.data<0?n.data=0:n.data=n.data.toFixed(2)}return n},s.prototype._addGeoUtilsLibrary=function(){if(!BMapGLLib.GeoUtils){var e=document.createElement("script");e.setAttribute("type","text/javascript"),e.setAttribute("src","//mapopen.cdn.bcebos.com/github/BMapGLLib/GeoUtils/src/GeoUtils.min.js"),document.body.appendChild(e)}},s.prototype._addGPCLibrary=function(){if(!window.gpcas){var e=document.createElement("script");e.setAttribute("type","text/javascript"),e.setAttribute("src","//mapopen.cdn.bcebos.com/github/BMapGLLib/DrawingManager/src/gpc.js"),document.body.appendChild(e)}},s.prototype._addLabel=function(e,t){var n=new BMapGL.Label(t,{position:e});return this._map.addOverlay(n),n},s.prototype._getRectanglePoint=function(e,t){return[new BMapGL.Point(e.lng,e.lat),new BMapGL.Point(t.lng,e.lat),new BMapGL.Point(t.lng,t.lat),new BMapGL.Point(e.lng,t.lat)]},s.prototype._dispatchOverlayComplete=function(e,t){var n={overlay:e,drawingMode:this._drawingType};t&&(n.calculate=t.data||null,n.label=t.label||null),this.dispatchEvent(this._drawingType+"complete",e),this.dispatchEvent("overlaycomplete",n)},s.prototype._dispatchOverlayCancel=function(e){var t={overlay:e,drawingMode:this._drawingType};this.dispatchEvent(this._drawingType+"cancel",e),this.dispatchEvent("overlaycancel",t)},s.prototype.getSorptionMatch=function(e,t,n){n=n||20;for(var i=this._map,a=i.pointToPixel(e),o=[],r=0;r<t.length;r++)if(t[r].getPath){var s=t[r].getPath(),l=s[0],p=s[s.length-1];l.equals(p)||s.push(s[0]);for(var c=1;c<s.length;c++){var d=i.pointToPixel(s[c-1]),g=i.pointToPixel(s[c]),h=[a.x-d.x,a.y-d.y],v=[g.x-d.x,g.y-d.y],u=[g.x-a.x,g.y-a.y],y=h[0]*v[0]+h[1]*v[1],m=Math.sqrt(Math.pow(h[0],2)+Math.pow(h[1],2))*Math.sqrt(Math.pow(v[0],2)+Math.pow(v[1],2)),f=Math.acos(y/m),M=v[0]*u[0]+v[1]*u[1],w=Math.sqrt(Math.pow(v[0],2)+Math.pow(v[1],2))*Math.sqrt(Math.pow(u[0],2)+Math.pow(u[1],2)),_=Math.acos(M/w);if(f<Math.PI/2&&_<Math.PI/2){var b=Math.sqrt(Math.pow(h[0],2)+Math.pow(h[1],2)),L=Math.sqrt(Math.pow(v[0],2)+Math.pow(v[1],2)),E=Math.cos(f)*b,A=E/L,B=Math.sin(f)*b,O=[d.x+v[0]*A,d.y+v[1]*A];B<n&&o.push({point:i.pixelToPoint({x:O[0],y:O[1]}),length:B})}}}return o.sort(function(e,t){return e.length-t.length}),o.length>0?o:null},s.prototype.mc2ll=function(e){var t=this._map,n=t.mercatorToLnglat(e.lng,e.lat);return new BMapGL.Point(n[0],n[1])},s.prototype.ll2mc=function(e){var t=this._map,n=t.lnglatToMercator(e.lng,e.lat);return new BMapGL.Point(n[0],n[1])},e.prototype=new BMapGL.Overlay,e.prototype.dispatchEvent=r.lang.Class.prototype.dispatchEvent,e.prototype.addEventListener=r.lang.Class.prototype.addEventListener,e.prototype.removeEventListener=r.lang.Class.prototype.removeEventListener,e.prototype.initialize=function(e){this._map=e;var t="polyline"===this.type?"长度":"面积",n="polyline"===this.type?"万米":"万平方米",i=this.div=document.createElement("div");i.className="operateWindow";var a='<div><span id="confirmOperate"></span><span id="cancelOperate"></span><span id="warnOperate">'+t+"不超过"+this.limit/1e4+n+"！</span></div>";return i.innerHTML=a,this._map.getPanes().markerPane.appendChild(i),this.updateWindow(),this._bind(),i},e.prototype._bind=function(){var e=this,t=this._map,n=this.overlay,i=this.overlays;document.getElementById("confirmOperate").addEventListener("click",function(a){if(t.removeOverlay(e),"rectangle"==e.type){var o=e.DrawingManager._calculate(n,n.getPath());e.DrawingManager.overlays.push(n)}else if("circle"==e.type){var o=e.DrawingManager._calculate(n,e.point);e.DrawingManager.overlays.push(n)}else if("polygon"==e.type){var o=e.DrawingManager._calculate(n,n.getPath());e.DrawingManager.overlays.push(n),n.disableEditing()}else if("polyline"==e.type){var o=e.DrawingManager._calculate(n,n.getPath());e.DrawingManager.overlays.push(n),n.disableEditing()}e.DrawingManager._dispatchOverlayComplete(n,o);for(var r=0;r<i.length;r++)if(Array.isArray(i[r]))for(var s in i[r])t.removeOverlay(i[r][s]);else t.removeOverlay(i[r]);e.DrawingManager.close()}),document.getElementById("cancelOperate").addEventListener("click",function(a){t.removeOverlay(e);for(var o=0;o<i.length;o++)if(Array.isArray(i[o]))for(var r in i[o])t.removeOverlay(i[o][r]);else t.removeOverlay(i[o]);t.removeOverlay(n),e.DrawingManager._dispatchOverlayCancel(n),e.DrawingManager.close()})},e.prototype.updateWindow=function(){if(null!==this.domElement){var e,t=this.overlay,n=this.limit;"rectangle"==this.type?e=this.DrawingManager._calculate(t,t.getPath()):"circle"==this.type?e=this.DrawingManager._calculate(t,this.point):"polygon"==this.type?e=this.DrawingManager._calculate(t,t.getPath()):"polyline"==this.type&&(e=this.DrawingManager._calculate(t,t.getPath())),"[object Number]"===Object.prototype.toString.call(n)&&e.data>n?(document.getElementById("confirmOperate").style.display="none",document.getElementById("warnOperate").style.display="block"):(document.getElementById("confirmOperate").style.display="block",document.getElementById("warnOperate").style.display="none")}},e.prototype.setPosition=function(e,t){this.point=e;var n=this._map,i=n.pointToOverlayPixel(this.point);t?(this.div.classList.remove("operateLeft"),this.div.style.left=i.x+15+"px"):(this.div.classList.add("operateLeft"),this.div.style.left=i.x-105+"px"),this.div.style.top=i.y-16+"px"},e.prototype.draw=function(){var e=this._map,t=e.pointToOverlayPixel(this.point);this.div.style.left=t.x+15+"px",this.div.style.top=t.y-16+"px"},t.prototype=new BMapGL.Overlay,t.prototype.dispatchEvent=r.lang.Class.prototype.dispatchEvent,t.prototype.addEventListener=r.lang.Class.prototype.addEventListener,t.prototype.removeEventListener=r.lang.Class.prototype.removeEventListener,t.prototype.initialize=function(e){this._map=e;var t=this.div=document.createElement("div");if(t.className="screenshot",
"circle"==this.type)var n='<div class="circlShot"><span id="screenshotNum">'+this.number+'</span><input id="circleInput" type="text" /><span class="unit">米</span></div>';else if("rectangle"==this.type)var n='<div class="rectWH"><div class="wh"><span id="rectWidth">'+this.number.width+'</span><input id="rectWidthInput" type="text" /></div><span class="multiple">x</span><div class="wh"><span id="rectHeight">'+this.number.height+'</span><input id="rectHeightInput" type="text" /></div><span class="unit">米</span></div>';return t.innerHTML=n,this._map.getPanes().markerPane.appendChild(t),this._bind(),t},t.prototype._bind=function(){this.setNumber(this.number),"circle"==this.type?this.bindCircleEvent():this.bindRectEvent()},t.prototype.bindCircleEvent=function(){var e=this,t=document.getElementById("screenshotNum"),n=document.getElementById("circleInput");t.addEventListener("click",function(e){var i=t.innerText;t.style.display="none",n.value=i,n.style.display="inline-block",n.focus()}),n.addEventListener("click",function(e){n.focus()}),n.addEventListener("keydown",function(i){if(13===i.keyCode){var a=n.value;n.style.display="none",t.style.display="inline-block",t.innerText=a;var o={radius:a,overlay:e.overlay};e._dispatchRadiusChange(o)}}),n.addEventListener("blur",function(i){var a=n.value;n.style.display="none",t.style.display="inline-block",t.innerText=a;var o={radius:a,overlay:e.overlay};e._dispatchRadiusChange(o)})},t.prototype.bindRectEvent=function(){var e=this,t=document.getElementById("rectWidth"),n=document.getElementById("rectWidthInput"),i=document.getElementById("rectHeight"),a=document.getElementById("rectHeightInput");n.value=t.innerText,a.value=i.innerText,t.addEventListener("click",function(e){var i=t.innerText;t.style.display="none",n.value=i,n.style.display="inline-block",n.focus()}),i.addEventListener("click",function(e){var t=i.innerText;i.style.display="none",a.value=t,a.style.display="inline-block",a.focus()}),n.addEventListener("click",function(e){n.focus()}),a.addEventListener("click",function(e){a.focus()}),n.addEventListener("keydown",function(o){if(13===o.keyCode){var r=n.value,s=a.value;n.style.display="none",a.style.display="none",t.style.display="inline-block",i.style.display="inline-block",t.innerText=r,i.innerText=s;var l={width:r,height:s,overlay:e.overlay};e._dispatchRectWHChange(l)}}),a.addEventListener("keydown",function(o){if(13===o.keyCode){var r=n.value,s=a.value;n.style.display="none",a.style.display="none",t.style.display="inline-block",i.style.display="inline-block",t.innerText=r,i.innerText=s;var l={width:r,height:s,overlay:e.overlay};e._dispatchRectWHChange(l)}})},t.prototype.setInfo=function(e,t){this.setNumber(t),this.setPosition(e)},t.prototype.setNumber=function(e){"circle"==this.type?document.getElementById("screenshotNum").textContent=e:(document.getElementById("rectWidth").textContent=e.width,document.getElementById("rectHeight").textContent=e.height)},t.prototype.setPosition=function(e){this.point=e;var t=this._map,n=this.type,i=t.pointToOverlayPixel(this.point);"circle"==n?(this.div.style.left=i.x-30+"px",this.div.style.top=i.y-40+"px"):"rectangle"==n&&(this.div.style.left=i.x+"px",this.div.style.top=i.y-45+"px")},t.prototype.draw=function(){var e=this._map,t=this.type,n=e.pointToOverlayPixel(this.point);"circle"==t?(this.div.style.left=n.x-30+"px",this.div.style.top=n.y-40+"px"):"rectangle"==t&&(this.div.style.left=n.x+"px",this.div.style.top=n.y-45+"px")},t.prototype._dispatchRadiusChange=function(e){this.dispatchEvent("radiuschange",e)},t.prototype._dispatchRectWHChange=function(e){this.dispatchEvent("rectwhchange",e)},n.prototype=new BMapGL.Overlay,n.prototype.dispatchEvent=r.lang.Class.prototype.dispatchEvent,n.prototype.addEventListener=r.lang.Class.prototype.addEventListener,n.prototype.removeEventListener=r.lang.Class.prototype.removeEventListener,n.prototype.initialize=function(e){var t=this;this._map=e;var n=this.container=document.createElement("div"),i=this._map.getSize();return n.style.cssText="position:absolute;background:transparent;cursor:crosshair;width:"+i.width+"px;height:"+i.height+"px",this._map.addEventListener("resize",function(e){t._adjustSize(e.size)}),this._map.getPanes().floatPane.appendChild(n),this._bind(),n},n.prototype.draw=function(){var e=this._map,t=e.pixelToPoint(new BMapGL.Pixel(0,0)),n=e.pointToOverlayPixel(t);this.container.style.left=n.x+"px",this.container.style.top=n.y+"px"},n.prototype.enableEdgeMove=function(){this._enableEdgeMove=!0},n.prototype.disableEdgeMove=function(){clearInterval(this._edgeMoveTimer),this._enableEdgeMove=!1},n.prototype._bind=function(){for(var e=this,t=(this._map,this.container),n=null,i=null,a=function(e){return{x:e.clientX,y:e.clientY}},o=function(t){var o=t.type;t=r.getEvent(t),point=e.getDrawPoint(t);var s=function(n){t.point=point,e.dispatchEvent(t)};o==e._eventMapping.mousedown&&(n=a(t));var l=a(t);"click"==o?Math.abs(l.x-n.x)<5&&Math.abs(l.y-n.y)<5&&(i&&Math.abs(l.x-i.x)<5&&Math.abs(l.y-i.y)<5?i=null:(s(),i=a(t))):s()},s=["click",e._eventMapping.mousedown,e._eventMapping.mousemove,e._eventMapping.mouseup,"dblclick"],l=s.length;l--;)r.on(t,s[l],o);r.on(t,e._eventMapping.mousemove,function(t){e._enableEdgeMove&&e.mousemoveAction(t)})},n.prototype.mousemoveAction=function(e){var t=this._map,n=this,i=t.pointToPixel(this.getDrawPoint(e)),a=function(e){var t=e.clientX,n=e.clientY;return e.changedTouches&&(t=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY),new BMapGL.Pixel(t,n)}(e),o=a.x-i.x,r=a.y-i.y;i=new BMapGL.Pixel(a.x-o,a.y-r),this._draggingMovePixel=i;t.pixelToPoint(i);this._panByX=this._panByY=0,i.x<=20||i.x>=t.width-20||i.y<=50||i.y>=t.height-10?(i.x<=20?this._panByX=8:i.x>=t.width-20&&(this._panByX=-8),i.y<=50?this._panByY=8:i.y>=t.height-10&&(this._panByY=-8),this._edgeMoveTimer||(this._edgeMoveTimer=setInterval(function(){t.panBy(n._panByX,n._panByY,{noAnimation:!0})},30))):this._edgeMoveTimer&&(clearInterval(this._edgeMoveTimer),this._edgeMoveTimer=null)},n.prototype._adjustSize=function(e){this.container.style.width=e.width+"px",this.container.style.height=e.height+"px"},n.prototype.getDrawPoint=function(e){var t=this._map,n=r.getTarget(e),i=e.offsetX||e.layerX||0,a=e.offsetY||e.layerY||0;for(1!=n.nodeType&&(n=n.parentNode);n&&n!=t.getContainer();)0==n.clientWidth&&0==n.clientHeight&&n.offsetParent&&"TD"==n.offsetParent.nodeName||(i+=n.offsetLeft||0,a+=n.offsetTop||0),n=n.offsetParent;var o=new BMapGL.Pixel(i,a);return t.pixelToPoint(o)},i.prototype=new BMapGL.Control,i.prototype.initialize=function(e){var t=this.container=document.createElement("div");t.className="BMapGLLib_Drawing";var n=this.panel=document.createElement("div");n.className="BMapGLLib_Drawing_panel",this.drawingToolOptions&&this.drawingToolOptions.hasCustomStyle&&this.drawingToolOptions.scale&&this._setScale(this.drawingToolOptions.scale),t.appendChild(n);var i=this._generalHtml();n.appendChild(i);var a=this.tip=document.createElement("div");return a.className="BMapGLLib_tip",a.innerHTML='<p class="BMapGLLib_tip_title"></p><p class="BMapGLLib_tip_text"></p>',this.drawingToolOptions.enableTips===!0&&n.appendChild(a),this._bind(n),this.drawingToolOptions.customContainer?r.g(this.drawingToolOptions.customContainer).appendChild(t):e.getContainer().appendChild(t),t},i.prototype._generalHtml=function(e){var t=this,n={};n.hander="拖动地图",n[BMAP_DRAWING_MARKER]="画点",n[BMAP_DRAWING_CIRCLE]="圆形工具",n[BMAP_DRAWING_POLYLINE]="画折线",n[BMAP_DRAWING_POLYGON]="多边形工具",n[BMAP_DRAWING_RECTANGLE]="矩形工具";for(var i=document.createDocumentFragment(),a=0,o=this.drawingModes.length;a<o;a++){var r="BMapGLLib_box BMapGLLib_"+this.drawingModes[a];a==o-1&&(r+=" BMapGLLib_last"),i.appendChild(function(e,i){var a=document.createElement("a");return a.className=e,a.href="javascript:void(0)",a.setAttribute("drawingType",i),a.setAttribute("onfocus","this.blur()"),a.addEventListener("mouseenter",function(e){var i=e.target.getAttribute("drawingType"),a=n[i];"hander"===i?(t.tip.children[0].innerText=a,t.tip.children[1].innerText="使用鼠标拖动地图"):(t.tip.className+=" "+i,t.tip.children[0].innerText=a,t.tip.children[1].innerText="使用"+a+"选出目标区域"),t.tip.style.display="block"}),a.addEventListener("mouseleave",function(e){for(var n=e.target.getAttribute("drawingType"),i=" "+t.tip.className.replace(/[\t\r\n]/g,"")+" ";i.indexOf(" "+n+" ")>=0;)i=i.replace(" "+n+" "," ");t.tip.className=i.replace(/^\s+|\s+$/g,""),t.tip.style.display="none"}),a}(r,this.drawingModes[a]))}return i},i.prototype._setScale=function(e){var t=-parseInt((390-390*e)/2,10),n=-parseInt((50-50*e)/2,10);this.container.style.cssText=["-moz-transform: scale("+e+");","-o-transform: scale("+e+");","-webkit-transform: scale("+e+");","transform: scale("+e+");","margin-left:"+t+"px;","margin-top:"+n+"px;","*margin-left:0px;","*margin-top:0px;","margin-left:0px\\0;","margin-top:0px\\0;","filter: progid:DXImageTransform.Microsoft.Matrix(","M11="+e+",","M12=0,","M21=0,","M22="+e+",","SizingMethod='auto expand');"].join("")},i.prototype._bind=function(e){var t=this;r.on(this.panel,"click",function(e){var n=r.getTarget(e),i=n.getAttribute("drawingType");t.setStyleByDrawingMode(i),t._bindEventByDraingMode(i)})},i.prototype.setStyleByDrawingMode=function(e){if(e)for(var t=this.panel.getElementsByTagName("a"),n=0,i=t.length;n<i;n++){var a=t[n];if(a.getAttribute("drawingType")==e){var o="BMapGLLib_box BMapGLLib_"+e+"_hover";n==i-1&&(o+=" BMapGLLib_last"),a.className=o}else a.className=a.className.replace(/_hover/,"")}},i.prototype._bindEventByDraingMode=function(e){var t=this.drawingManager;t._isOpen&&t.getDrawingMode()===e?(t.close(),t._map.enableDoubleClickZoom()):(t.setDrawingMode(e),t.open(),t._map.disableDoubleClickZoom())};var p=[]}();